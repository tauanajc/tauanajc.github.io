<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Tutorial 4 - Statistical Modeling &middot; Tauana Cunha</title>
        <meta name="description" content="In this tutorial, we will learn the basics of how statistical modeling in R works, and then briefly overview methods of ordination.
To do this, we will use a dataset about covid19 put together by Our World in Data, joined to another dataset obtained in the same place that includes country responses (school closings, etc). The main goal here is to learn about modelling in R, but we also include in the end the steps taken to clean the data and merge tables as we need here.">
        <meta name="HandheldFriendly" content="True">
        <meta name="MobileOptimized" content="320">
        <meta name="generator" content="Hugo 0.69.0" />
        <meta name="robots" content="index,follow">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta property="og:title" content="Tutorial 4 - Statistical Modeling">
<meta property="og:description" content="In this tutorial, we will learn the basics of how statistical modeling in R works, and then briefly overview methods of ordination.
To do this, we will use a dataset about covid19 put together by Our World in Data, joined to another dataset obtained in the same place that includes country responses (school closings, etc). The main goal here is to learn about modelling in R, but we also include in the end the steps taken to clean the data and merge tables as we need here.">
<meta property="og:type" content="article">
<meta property="og:url" content="/courses/2020_stri_introR/tutorials/l4_stats/">
        <link rel="stylesheet" href="/courses/2020_stri_introR/dist/site.css">
        <link rel="stylesheet" href="/courses/2020_stri_introR/dist/syntax.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
        
        
        
        
    </head>
    <body>
        

        <div id="wrapper">
            <header class="site-header">
                <div class="container">
                    <div class="site-title-wrapper">
                        
                            <h1 class="site-title">
                                <a title="Tutorials" href="/courses/2020_stri_introR/">Tutorials</a>
                            </h1>
                        
                        <a class="button-square" href="/courses/2020_stri_introR/index.xml"><i class="fa fa-rss"></i></a>
                        
                        
                        
                        
                        
                        
                        
                        
                    </div>

                    <ul class="site-nav">
                        
    <li class="site-nav-item">
        <a title="Home" href="/courses/2020_stri_introR/">Home</a>
    </li>

    <li class="site-nav-item">
        <a title="Schedule" href="/courses/2020_stri_introR/page/schedule/">Schedule</a>
    </li>

    <li class="site-nav-item">
        <a title="Resources" href="/courses/2020_stri_introR/page/resources/">Resources</a>
    </li>

    <li class="site-nav-item">
        <a title="" href=""></a>
    </li>

                    </ul>
                </div>
            </header>

            <div id="container">


<div class="container">
    <article class="post-container">
        <header class="post-header">
    <h1 class="post-title">Tutorial 4 - Statistical Modeling</h1>
    
</header>

        <div class="post-content clearfix">
    

    


<p>In this tutorial, we will learn the basics of how statistical modeling in R works, and then briefly overview methods of ordination.</p>
<p>To do this, we will use a dataset about covid19 put together by <a href="https://ourworldindata.org/">Our World in Data</a>, joined to another dataset obtained in the same place that includes country responses (school closings, etc). The main goal here is to learn about modelling in R, but we also include in the end the steps taken to clean the data and merge tables as we need here. You can check this out to learn how to do these things to your datasets.</p>
<p>By using linear models, we will try to understand which responses of countries around the world to covid19 in the last months seem to be important in predicting the current number of daily cases.</p>
<p>In the second part, with ordination, we will visualize which countries are more similar to each other in the interventions they have taken in the last two weeks, and whether this has any relationship to geography.</p>
<div id="linear-models" class="section level1">
<h1>Linear models</h1>
<div id="overview" class="section level2">
<h2>Overview</h2>
<p>We use linear models (or linear regressions) to establish the relationship between a <strong>response</strong> (or dependent) variable and one or more <strong>predictive</strong> (or independent) variables. The goal can either be to explain the variation in the response variable, or to predict a response given what is known about a series of predictors.</p>
<p>R provides a very flexible syntax for linear models, and many kinds of analyses, such as t-tests, ANOVAs and ANCOVAs, can be treated as specific cases of linear models.
If you check the <a href="https://en.wikipedia.org/wiki/Student%27s_t-test#Slope_of_a_regression_line">Wikipedia article for t-test</a>, for example, you will find out that it is actually the same as testing the slope of a linear model, which we will do below.</p>
<p>To learn how to use linear models in R, we will first load a dataset with information on cases and responses to covid19 across countries. Then, we will explore this dataset with graphs, using functions that we have seen in the last tutorial. We will then start by fitting simple models, and then making them more complex including more variables. Finally, we will test which model fits the data better and do some predictions.</p>
</div>
<div id="loading-and-exploring-the-data" class="section level2">
<h2>Loading and exploring the data</h2>
<p>Let’s start by loading the dataset with <code>read.csv()</code>. Remeber to include the path to the folder in which it is located, or use <code>setwd()</code> to set the working directory first. Just in case, we will also clear the memory and erase everything before we start, with <code>rm(list = ls())</code>.</p>
<p>By use the argument <code>row.names = 1</code>, we are telling <code>read.csv()</code> that the first column is not really data, but just row numbers.</p>
<pre class="r"><code>covid_data &lt;- read.csv(&#39;covid_data_2020-05-16.csv&#39;, row.names = 1)
head(covid_data)</code></pre>
<pre><code>##   iso_code         country_name                    world_region past_cases
## 1      ABW                Aruba Latin America and the Caribbean        1.4
## 2      AFG          Afghanistan            Asia and the Pacific       52.6
## 3      AGO               Angola                          Africa        0.0
## 4      ALB              Albania                          Europe       15.6
## 5      AND              Andorra                          Europe       14.4
## 6      ARE United Arab Emirates                       West Asia      401.0
##   new_cases new_deaths new_cases_per_million new_deaths_per_million new_tests
## 1       0.0        0.0                0.0000                 0.0000        NA
## 2     400.0        9.6               10.2754                 0.2464        NA
## 3       0.6        0.0                0.0182                 0.0000        NA
## 4       9.6        0.0                3.3360                 0.0000        NA
## 5       1.2        0.2               15.5308                 2.5884        NA
## 6     726.6        2.4               73.4652                 0.2424        NA
##   new_tests_per_thousand tests_units population population_density median_age
## 1                     NA          NA     106766            584.800       41.2
## 2                     NA          NA   38928341             54.422       18.6
## 3                     NA          NA   32866268             23.890       16.8
## 4                     NA          NA    2877800            104.871       38.0
## 5                     NA          NA      77265            163.755         NA
## 6                     NA          NA    9890400            112.442       34.0
##   aged_65_older aged_70_older gdp_per_capita extreme_poverty cvd_death_rate
## 1        13.085         7.452      35973.781              NA             NA
## 2         2.581         1.337       1803.987              NA        597.029
## 3         2.405         1.362       5819.495              NA        276.045
## 4        13.188         8.643      11803.431             1.1        304.195
## 5            NA            NA             NA              NA        109.135
## 6         1.144         0.526      67293.483              NA        317.840
##   diabetes_prevalence female_smokers male_smokers handwashing_facilities
## 1               11.62             NA           NA                     NA
## 2                9.59             NA           NA                 37.746
## 3                3.94             NA           NA                 26.664
## 4               10.08            7.1         51.2                     NA
## 5                7.97           29.0         37.8                     NA
## 6               17.26            1.2         37.4                     NA
##   hospital_beds_per_100k total_cases total_deaths total_cases_per_million
## 1                     NA         101            3                 945.994
## 2                   0.50        6402          168                 164.456
## 3                     NA          48            2                   1.460
## 4                   2.89         916           31                 318.299
## 5                     NA         761           49                9849.220
## 6                   1.20       21831          210                2207.292
##   total_deaths_per_million total_tests total_tests_per_thousand
## 1                   28.099          NA                       NA
## 2                    4.316          NA                       NA
## 3                    0.061          NA                       NA
## 4                   10.772          NA                       NA
## 5                  634.181          NA                       NA
## 6                   21.233          NA                       NA
##   C1_School.closing C1_Flag C2_Workplace.closing C2_Flag
## 1                 3       1                    3       1
## 2                 3       1                    3       0
## 3                 3       1                    2       1
## 4                 3       1                    2       0
## 5                 3       1                    2       1
## 6                 3       1                    2       1
##   C3_Cancel.public.events C3_Flag C4_Restrictions.on.gatherings C4_Flag
## 1                       2       1                             4       1
## 2                       2       1                             4       1
## 3                       2       1                             4       1
## 4                       2       1                             4       1
## 5                       1       1                             0      NA
## 6                       2       1                             4       1
##   C5_Close.public.transport C5_Flag C6_Stay.at.home.requirements C6_Flag
## 1                         0       1                            2       1
## 2                         2       0                            2       0
## 3                         1       1                            2       1
## 4                         2       0                            2       1
## 5                         1       1                            1       1
## 6                         1       1                            2       1
##   C7_Restrictions.on.internal.movement C7_Flag C8_International.travel.controls
## 1                                    2       1                                3
## 2                                    2       0                                1
## 3                                    2       1                                4
## 4                                    2       1                                4
## 5                                    0      NA                                3
## 6                                    1       1                                4
##   E1_Income.support E1_Flag E2_Debt.contract.relief E3_Fiscal.measures
## 1                 0      NA                       2                  0
## 2                 0      NA                       0                 NA
## 3                 0      NA                       2                  0
## 4                 2       0                       1                  0
## 5                 2       1                       0                  0
## 6                 0      NA                       2                  0
##   E4_International.support H1_Public.information.campaigns H1_Flag
## 1                        0                               2       1
## 2                        0                               2       1
## 3                        0                               1       1
## 4                        0                               2       1
## 5                       NA                               2       1
## 6                        0                               2       1
##   H2_Testing.policy H3_Contact.tracing H4_Emergency.investment.in.healthcare
## 1                 1                  0                                     0
## 2                 1                  1                                     0
## 3                 2                  0                                     0
## 4                 2                  1                                     0
## 5                 3                  1                                     0
## 6                 3                  2                                     0
##   H5_Investment.in.vaccines M1_Wildcard ConfirmedCases ConfirmedDeaths
## 1                         0          NA            100               2
## 2                         0          NA            784              30
## 3                         0          NA             24               2
## 4                         0          NA            494              31
## 5                         0          NA            743              40
## 6                         0          NA           5825              33
##   StringencyIndex StringencyIndexForDisplay LegacyStringencyIndex
## 1           83.46                     83.46                 80.00
## 2           76.33                     76.33                 75.48
## 3           86.77                     86.77                 84.05
## 4           88.36                     88.36                 85.24
## 5           59.12                     59.12                 74.05
## 6           86.77                     86.77                 85.24
##   LegacyStringencyIndexForDisplay
## 1                           80.00
## 2                           75.48
## 3                           84.05
## 4                           85.24
## 5                           74.05
## 6                           85.24</code></pre>
<p>At the end of this tutorial we explain how this dataset was made and provide links with the explanation of each column.
This dataset includes 63 columns with information for 155 countries. <code>new_cases</code> (and every column starting with <strong>new_</strong>) are averaged over the past 5 days, and <code>past_cases</code> are the average of 15-20 days ago. The different country responses (all columns after <code>C1_School.closing</code>) correspond to the most frequent response in the past 2 weeks. Therefore, this dataset provides a baseline of how many new cases of covid19 there were 2 weeks ago, the government response during the last 2 weeks, and the current number of new cases.</p>
<p>We will start by reducing the dataset to only a few columns that we will use to learn linear models, making it more manageable.</p>
<p>To explore the data before we start, let’s make a smaller version with only a few columns. Let’s retain the number of new cases, number of cases two weeks ago, gdp per capita, stringency index, international travel control, school closing and income support.</p>
<p>You can find definitions for all variables in the <a href="https://github.com/OxCGRT/covid-policy-tracker/blob/master/documentation/codebook.md">dataset website</a>:</p>
<p><strong>Stringency index</strong> is an index that summarizes the overal stringency of government measures on a scale of 0-100. The other columns are coded as follows:</p>
<p><strong>C1_School closing</strong></p>
<p>Record closings of schools and universities</p>
<ol start="0" style="list-style-type: decimal">
<li>no measures</li>
<li>recommend closing</li>
<li>require closing (only some levels or categories, eg just high school, or just public schools)</li>
<li>require closing all levels</li>
</ol>
<p><strong>C2_Workplace closing</strong></p>
<p>Record closings of workplaces</p>
<ol start="0" style="list-style-type: decimal">
<li>no measures</li>
<li>recommend closing (or recommend work from home)</li>
<li>require closing (or work from home) for some sectors or categories of workers</li>
<li>require closing (or work from home) for all-but-essential workplaces (eg grocery stores, doctors)</li>
</ol>
<p><strong>E1_Income support</strong></p>
<p>Record if the government is providing direct cash payments to people who lose their jobs or cannot work.</p>
<ol start="0" style="list-style-type: decimal">
<li>no income support</li>
<li>government is replacing less than 50% of lost salary (or if a flat sum, it is less than 50% median salary)</li>
<li>government is replacing more than 50% of lost salary (or if a flat sum, it is greater than 50% median salary)</li>
</ol>
<p>To see column names, we can use the function <code>colnames()</code></p>
<pre class="r"><code>colnames(covid_data)</code></pre>
<pre><code>##  [1] &quot;iso_code&quot;                             
##  [2] &quot;country_name&quot;                         
##  [3] &quot;world_region&quot;                         
##  [4] &quot;past_cases&quot;                           
##  [5] &quot;new_cases&quot;                            
##  [6] &quot;new_deaths&quot;                           
##  [7] &quot;new_cases_per_million&quot;                
##  [8] &quot;new_deaths_per_million&quot;               
##  [9] &quot;new_tests&quot;                            
## [10] &quot;new_tests_per_thousand&quot;               
## [11] &quot;tests_units&quot;                          
## [12] &quot;population&quot;                           
## [13] &quot;population_density&quot;                   
## [14] &quot;median_age&quot;                           
## [15] &quot;aged_65_older&quot;                        
## [16] &quot;aged_70_older&quot;                        
## [17] &quot;gdp_per_capita&quot;                       
## [18] &quot;extreme_poverty&quot;                      
## [19] &quot;cvd_death_rate&quot;                       
## [20] &quot;diabetes_prevalence&quot;                  
## [21] &quot;female_smokers&quot;                       
## [22] &quot;male_smokers&quot;                         
## [23] &quot;handwashing_facilities&quot;               
## [24] &quot;hospital_beds_per_100k&quot;               
## [25] &quot;total_cases&quot;                          
## [26] &quot;total_deaths&quot;                         
## [27] &quot;total_cases_per_million&quot;              
## [28] &quot;total_deaths_per_million&quot;             
## [29] &quot;total_tests&quot;                          
## [30] &quot;total_tests_per_thousand&quot;             
## [31] &quot;C1_School.closing&quot;                    
## [32] &quot;C1_Flag&quot;                              
## [33] &quot;C2_Workplace.closing&quot;                 
## [34] &quot;C2_Flag&quot;                              
## [35] &quot;C3_Cancel.public.events&quot;              
## [36] &quot;C3_Flag&quot;                              
## [37] &quot;C4_Restrictions.on.gatherings&quot;        
## [38] &quot;C4_Flag&quot;                              
## [39] &quot;C5_Close.public.transport&quot;            
## [40] &quot;C5_Flag&quot;                              
## [41] &quot;C6_Stay.at.home.requirements&quot;         
## [42] &quot;C6_Flag&quot;                              
## [43] &quot;C7_Restrictions.on.internal.movement&quot; 
## [44] &quot;C7_Flag&quot;                              
## [45] &quot;C8_International.travel.controls&quot;     
## [46] &quot;E1_Income.support&quot;                    
## [47] &quot;E1_Flag&quot;                              
## [48] &quot;E2_Debt.contract.relief&quot;              
## [49] &quot;E3_Fiscal.measures&quot;                   
## [50] &quot;E4_International.support&quot;             
## [51] &quot;H1_Public.information.campaigns&quot;      
## [52] &quot;H1_Flag&quot;                              
## [53] &quot;H2_Testing.policy&quot;                    
## [54] &quot;H3_Contact.tracing&quot;                   
## [55] &quot;H4_Emergency.investment.in.healthcare&quot;
## [56] &quot;H5_Investment.in.vaccines&quot;            
## [57] &quot;M1_Wildcard&quot;                          
## [58] &quot;ConfirmedCases&quot;                       
## [59] &quot;ConfirmedDeaths&quot;                      
## [60] &quot;StringencyIndex&quot;                      
## [61] &quot;StringencyIndexForDisplay&quot;            
## [62] &quot;LegacyStringencyIndex&quot;                
## [63] &quot;LegacyStringencyIndexForDisplay&quot;</code></pre>
<p>Now let’s make a new data.frame only with the desired columns. Remeber that when indexing data.frames or matrices, we can use either column numbers or column names. Here we will use numbers to make it simpler:</p>
<pre class="r"><code>covid_small &lt;- covid_data[,c(2,3,5,4,17,33,46,60)]
head(covid_small)</code></pre>
<pre><code>##           country_name                    world_region new_cases past_cases
## 1                Aruba Latin America and the Caribbean       0.0        1.4
## 2          Afghanistan            Asia and the Pacific     400.0       52.6
## 3               Angola                          Africa       0.6        0.0
## 4              Albania                          Europe       9.6       15.6
## 5              Andorra                          Europe       1.2       14.4
## 6 United Arab Emirates                       West Asia     726.6      401.0
##   gdp_per_capita C2_Workplace.closing E1_Income.support StringencyIndex
## 1      35973.781                    3                 0           83.46
## 2       1803.987                    3                 0           76.33
## 3       5819.495                    2                 0           86.77
## 4      11803.431                    2                 2           88.36
## 5             NA                    2                 2           59.12
## 6      67293.483                    2                 0           86.77</code></pre>
<p>Now, to explore this dataset, we can use the functions <code>summary()</code> and <code>plot()</code>:</p>
<p>Summary will show some statistics for each column.</p>
<pre class="r"><code>summary(covid_small)</code></pre>
<pre><code>##  country_name       world_region         new_cases         past_cases      
##  Length:160         Length:160         Min.   :    0.0   Min.   :    0.00  
##  Class :character   Class :character   1st Qu.:    3.9   1st Qu.:    3.35  
##  Mode  :character   Mode  :character   Median :   22.1   Median :   22.10  
##                                        Mean   :  537.7   Mean   :  464.30  
##                                        3rd Qu.:  209.6   3rd Qu.:  142.95  
##                                        Max.   :22719.6   Max.   :27620.80  
##                                                                            
##  gdp_per_capita     C2_Workplace.closing E1_Income.support StringencyIndex 
##  Min.   :   661.2   Min.   :0.000        Min.   :0.0000    Min.   : 16.67  
##  1st Qu.:  5034.7   1st Qu.:2.000        1st Qu.:0.0000    1st Qu.: 76.19  
##  Median : 13367.6   Median :2.000        Median :1.0000    Median : 84.26  
##  Mean   : 20330.7   Mean   :2.165        Mean   :0.8065    Mean   : 81.12  
##  3rd Qu.: 30155.2   3rd Qu.:3.000        3rd Qu.:1.0000    3rd Qu.: 91.40  
##  Max.   :116935.6   Max.   :3.000        Max.   :2.0000    Max.   :100.00  
##  NA&#39;s   :7          NA&#39;s   :2            NA&#39;s   :5         NA&#39;s   :3</code></pre>
<p>Plot will quickly plot scatterplots of two variables together, so we can already have some idea about which variables are related. Let’s plot all columns except for the first two (<code>country name</code> and <code>world region</code>)</p>
<pre class="r"><code>plot(covid_small[,-c(1,2)])</code></pre>
<p><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>We can also use a for loop to plot a histogram for each column. The function <code>ncol()</code> retrieves the number of columns of a data.frame, and we will use it to loop from column 3 to the last one.</p>
<pre class="r"><code>for (i in 3:ncol(covid_small)){
  hist(covid_small[,i],main = colnames(covid_small)[i])
}</code></pre>
<p><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-6-1.png" width="672" /><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-6-2.png" width="672" /><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-6-3.png" width="672" /><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-6-4.png" width="672" /><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-6-5.png" width="672" /><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-6-6.png" width="672" /></p>
<p>It is hard to visualize number of cases in the linear scale like this, let’s try doing a histogram of the logs:</p>
<pre class="r"><code>hist(log10(covid_small[,3]), main = colnames(covid_small)[3])</code></pre>
<p><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<pre class="r"><code>hist(log10(covid_small[,4]), main = colnames(covid_small)[4])</code></pre>
<p><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-7-2.png" width="672" /></p>
<p>A few observations of this initial exploration:</p>
<ol style="list-style-type: decimal">
<li>It will probably be a good idea to log-transform the number of cases, since they vary over orders of magnitude</li>
<li>It also seems that the number of new cases is highly correlated with number of cases 2 weeks ago, so we always have to take that into account.</li>
<li>Some of our possible independent variables seem to be correlated: richer countries seem to have closed schools more often, for example.</li>
</ol>
<p>It is always good to visualize your dataset before starting to do inferences, so you will know how to best build your and models interpret them!</p>
<p>Before we proceed, let’s prepare the dataset we will use throughout the tutorial for linear models. We need to make sure all data columns have the appropriate type. For linear models, type matters, and specifically we have three important types:</p>
<ul>
<li><code>numeric</code>: columns with this type will be treated as a continuous variable. Example: number of cases.</li>
<li><code>unordered factor</code>: columns with this type will be treated as categorical variables. Example: world region</li>
<li><code>ordered factor</code>: columns with this type will be treated as ordinal variables. Example: Stringency of workplace closing</li>
</ul>
<p>Let’s use <code>str()</code> to figure out the current data types for our columns and change as needed.</p>
<pre class="r"><code>str(covid_small)</code></pre>
<pre><code>## &#39;data.frame&#39;:    160 obs. of  8 variables:
##  $ country_name        : chr  &quot;Aruba&quot; &quot;Afghanistan&quot; &quot;Angola&quot; &quot;Albania&quot; ...
##  $ world_region        : chr  &quot;Latin America and the Caribbean&quot; &quot;Asia and the Pacific&quot; &quot;Africa&quot; &quot;Europe&quot; ...
##  $ new_cases           : num  0 400 0.6 9.6 1.2 ...
##  $ past_cases          : num  1.4 52.6 0 15.6 14.4 401 91.4 44 162 52.4 ...
##  $ gdp_per_capita      : num  35974 1804 5819 11803 NA ...
##  $ C2_Workplace.closing: int  3 3 2 2 2 2 2 2 2 3 ...
##  $ E1_Income.support   : int  0 0 0 2 2 0 1 1 2 2 ...
##  $ StringencyIndex     : num  83.5 76.3 86.8 88.4 59.1 ...</code></pre>
<p>Country name and world region are currently characters. R will automatically convert them to unordered factors when we fit a model, but it is good practice to be explicit. Let’s change them to factors.</p>
<pre class="r"><code>covid_small$country_name &lt;- factor(covid_small$country_name)
covid_small$world_region &lt;- factor(covid_small$world_region)</code></pre>
<p>Stringency Index, gdp per capita and numbers of cases are currently numeric, as they should be, so we will do nothing.</p>
<p>International travel controls and Income support are currently considered as integer numbers, but they are not quite. They are ordinal variables encoded as numbers. Let’s transform them into ordered factors:</p>
<pre class="r"><code>covid_small$E1_Income.support &lt;- factor(covid_small$E1_Income.support, ordered = T)

covid_small$C2_Workplace.closing &lt;- factor(covid_small$C2_Workplace.closing, ordered = T)</code></pre>
<p>Let’s look at the data now:</p>
<pre class="r"><code>str(covid_small)</code></pre>
<pre><code>## &#39;data.frame&#39;:    160 obs. of  8 variables:
##  $ country_name        : Factor w/ 160 levels &quot;Afghanistan&quot;,..: 7 1 5 2 4 150 6 8 9 10 ...
##  $ world_region        : Factor w/ 6 levels &quot;Africa&quot;,&quot;Asia and the Pacific&quot;,..: 4 2 1 3 3 6 4 2 3 3 ...
##  $ new_cases           : num  0 400 0.6 9.6 1.2 ...
##  $ past_cases          : num  1.4 52.6 0 15.6 14.4 401 91.4 44 162 52.4 ...
##  $ gdp_per_capita      : num  35974 1804 5819 11803 NA ...
##  $ C2_Workplace.closing: Ord.factor w/ 4 levels &quot;0&quot;&lt;&quot;1&quot;&lt;&quot;2&quot;&lt;&quot;3&quot;: 4 4 3 3 3 3 3 3 3 4 ...
##  $ E1_Income.support   : Ord.factor w/ 3 levels &quot;0&quot;&lt;&quot;1&quot;&lt;&quot;2&quot;: 1 1 1 3 3 1 2 2 3 3 ...
##  $ StringencyIndex     : num  83.5 76.3 86.8 88.4 59.1 ...</code></pre>
<p>Seems better. Treating columns as factors also allow us to change the names of their levels to something more informative. Using the key above, let’s do it wiht income support. Currently, level names are <code>0</code>, <code>1</code> and <code>2</code>. Let’s change to <code>none</code>, <code>less than 50%</code> and <code>more than 50%</code>.</p>
<pre class="r"><code>levels(covid_small$E1_Income.support) &lt;- c(&#39;none&#39;,
                                          &#39;less than 50%&#39;,
                                          &#39;more than 50%&#39;)</code></pre>
<p>Now let’s check:</p>
<pre class="r"><code>str(covid_small)</code></pre>
<pre><code>## &#39;data.frame&#39;:    160 obs. of  8 variables:
##  $ country_name        : Factor w/ 160 levels &quot;Afghanistan&quot;,..: 7 1 5 2 4 150 6 8 9 10 ...
##  $ world_region        : Factor w/ 6 levels &quot;Africa&quot;,&quot;Asia and the Pacific&quot;,..: 4 2 1 3 3 6 4 2 3 3 ...
##  $ new_cases           : num  0 400 0.6 9.6 1.2 ...
##  $ past_cases          : num  1.4 52.6 0 15.6 14.4 401 91.4 44 162 52.4 ...
##  $ gdp_per_capita      : num  35974 1804 5819 11803 NA ...
##  $ C2_Workplace.closing: Ord.factor w/ 4 levels &quot;0&quot;&lt;&quot;1&quot;&lt;&quot;2&quot;&lt;&quot;3&quot;: 4 4 3 3 3 3 3 3 3 4 ...
##  $ E1_Income.support   : Ord.factor w/ 3 levels &quot;none&quot;&lt;&quot;less than 50%&quot;&lt;..: 1 1 1 3 3 1 2 2 3 3 ...
##  $ StringencyIndex     : num  83.5 76.3 86.8 88.4 59.1 ...</code></pre>
<p>Let’s do the same for International Travel controls:</p>
<pre class="r"><code>levels(covid_small$C2_Workplace.closing) &lt;- c(&#39;none&#39;,
                                             &#39;recommend&#39;,
                                             &#39;require some&#39;,
                                             &#39;require most&#39;)</code></pre>
<p>Finally, let’s change the names of some variables to something shorter and easier to type. Current names are:</p>
<pre class="r"><code>colnames(covid_small)</code></pre>
<pre><code>## [1] &quot;country_name&quot;         &quot;world_region&quot;         &quot;new_cases&quot;           
## [4] &quot;past_cases&quot;           &quot;gdp_per_capita&quot;       &quot;C2_Workplace.closing&quot;
## [7] &quot;E1_Income.support&quot;    &quot;StringencyIndex&quot;</code></pre>
<p>Let’s change some of them by using their index:</p>
<pre class="r"><code>colnames(covid_small)[6] &lt;- &#39;work_close&#39;

colnames(covid_small)[7] &lt;- &#39;income_support&#39;

colnames(covid_small)[8] &lt;- &#39;stringency_idx&#39;</code></pre>
<p>Now let’s look at our dataset:</p>
<pre class="r"><code>str(covid_small)</code></pre>
<pre><code>## &#39;data.frame&#39;:    160 obs. of  8 variables:
##  $ country_name  : Factor w/ 160 levels &quot;Afghanistan&quot;,..: 7 1 5 2 4 150 6 8 9 10 ...
##  $ world_region  : Factor w/ 6 levels &quot;Africa&quot;,&quot;Asia and the Pacific&quot;,..: 4 2 1 3 3 6 4 2 3 3 ...
##  $ new_cases     : num  0 400 0.6 9.6 1.2 ...
##  $ past_cases    : num  1.4 52.6 0 15.6 14.4 401 91.4 44 162 52.4 ...
##  $ gdp_per_capita: num  35974 1804 5819 11803 NA ...
##  $ work_close    : Ord.factor w/ 4 levels &quot;none&quot;&lt;&quot;recommend&quot;&lt;..: 4 4 3 3 3 3 3 3 3 4 ...
##  $ income_support: Ord.factor w/ 3 levels &quot;none&quot;&lt;&quot;less than 50%&quot;&lt;..: 1 1 1 3 3 1 2 2 3 3 ...
##  $ stringency_idx: num  83.5 76.3 86.8 88.4 59.1 ...</code></pre>
<p>Looks good! The only step left is to remove NAs from the data. As we have seen in the second lesson, we can do it later when we will actually use the data, and this might be the best approach if there is a lot of scattered missing data. This is because <code>na.omit</code> on the whole data.frame will remove all rows with data missing for at least one column. In this dataset only 12 of the 160 countries included have missing datain some variable, so it won’t hurt much to remove these countries now so we do not need to think about it anymore.</p>
<pre class="r"><code>covid_small &lt;- na.omit(covid_small)</code></pre>
<p>The data is ready, let’s start modeling.</p>
</div>
<div id="fitting-a-model-with-categorical-variables-using-formulas" class="section level2">
<h2>Fitting a model with categorical variables using formulas</h2>
<p>The syntax that R uses to fit a model are formulas. We have seen formulas before, using them in plots in tutorial 3 and to fit models in tutorial 2. Let’s explain formulas a bit more here. You can get more help on formulas by using the help function:</p>
<pre class="r"><code>help(formula)</code></pre>
<p>The basic syntax of a formula is:</p>
<pre><code>response ~ predictor</code></pre>
<p>This means that a variable named <code>response</code> depeends (<code>~</code>) on a variable named <code>predictor</code>. We can also use formulas with more than one variable as predictor, by using a plus sign:</p>
<pre><code>response ~ predictor1 + predictor2</code></pre>
<p>This means that the variable <code>response</code> depends on <code>predictor1</code> and <code>predictor2</code>, and that the effect of each predictor variable is independent of each other.</p>
<p>If the effect of predictors not only add to each other but also interact to generate the response, we can indicate that with an asterisk:</p>
<pre><code>response ~ predictor1 * predictor2</code></pre>
<p>This means that the two predictors interact with each other and also have individual effects.</p>
<p>It is also possible to indicate in a formula that a variable is nested within another. Let’s imagine that you repeated an experiment in several locations and that you want to indicate that, a common formula would be:</p>
<pre><code>response ~ predictor %in% location</code></pre>
<p>Finally, you can include mathematical expressions in formulas. Let’s say you want to log-transform your response variable, for example. You can write this as:</p>
<pre><code>log(response) ~ predictor</code></pre>
<p>There are more things you can do with formulas, but let’s stop here for now and see it in practice. Let’s start by using a linear model to check whether the number of total cases varies between world regions. First, as we recommended before, let’s visualize whether this seems to be the case by using a boxplot. Both boxplots and linear models can take formulas!</p>
<pre class="r"><code>boxplot(formula = new_cases ~ world_region, data = covid_small)</code></pre>
<p><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>It seems it does, but it might be easier to visualize with a log scale. With base R, we use the parameter <code>log='y'</code> to indicate that we want a log scale on the y axis:</p>
<pre class="r"><code>boxplot(formula = new_cases ~ world_region, data = covid_small, log=&#39;y&#39;)</code></pre>
<pre><code>## Warning in plot.window(xlim = xlim, ylim = ylim, log = log, yaxs = pars$yaxs):
## nonfinite axis limits [GScale(-inf,4.3564,2, .); log=1]</code></pre>
<p><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<p>Oops, there was an error! The reason is that some countries have 0 new cases in the past 5 days, and <span class="math inline">\(log(0)\)</span> is undefined. In base R, there is no way to correct this with graph scales (we will see below how to do with ggplot). However, we can add the log transformation to the formula and pass to <code>boxplot()</code> the transformed data instead of the raw data. A typical log transformation when there are 0 values is <span class="math inline">\(log_{10}(x+1)\)</span>:</p>
<pre class="r"><code>boxplot(formula = log10(new_cases+1) ~ world_region, data = covid_small)</code></pre>
<p><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p>It seems there are variations between regions, but North America has many more cases. Is that difference significant? We will use a linear model to test. The syntax is similar that what we used to build the boxplot, but we will use the function <code>lm()</code>:</p>
<pre class="r"><code>region_model &lt;- lm(formula = new_cases ~ world_region, data = covid_small)</code></pre>
<p>To check the results of our model fit, we can use the function summary:</p>
<pre class="r"><code>summary(region_model)</code></pre>
<pre><code>## 
## Call:
## lm(formula = new_cases ~ world_region, data = covid_small)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -10784.4   -536.8   -311.7    -39.6  10784.4 
## 
## Coefficients:
##                                             Estimate Std. Error t value
## (Intercept)                                    62.97     290.34   0.217
## world_regionAsia and the Pacific              327.72     464.14   0.706
## world_regionEurope                            501.52     418.42   1.199
## world_regionLatin America and the Caribbean   689.28     459.06   1.501
## world_regionNorth America                   11872.23    1361.80   8.718
## world_regionWest Asia                         502.81     662.07   0.759
##                                             Pr(&gt;|t|)    
## (Intercept)                                    0.829    
## world_regionAsia and the Pacific               0.481    
## world_regionEurope                             0.233    
## world_regionLatin America and the Caribbean    0.135    
## world_regionNorth America                   6.76e-15 ***
## world_regionWest Asia                          0.449    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1882 on 142 degrees of freedom
## Multiple R-squared:  0.3502, Adjusted R-squared:  0.3273 
## F-statistic:  15.3 on 5 and 142 DF,  p-value: 5.082e-12</code></pre>
<p>Summary shows a few different things about the model. For now, let’s pay attention to the coefficients table. This is a table with the estimates for all components of our model, and the p-value of each coefficient. When the predictor is an unordered factor, it uses the first level of the factor as the intercept. Here it is Africa, which is considered our baseline, and the other estimated coefficients denote the difference between each region and Africa. It seems that North America is significantly different from Africa, while the other regions are not.</p>
<p>However, before we jump to conclusions, we have to answer two questions first to check if our interpretation is valid:
1. does this model fit our assumptions about the data?
2. do we need world regions at all to explain differences between countries?</p>
<p>To answer the first question, we need to evaluate our model fit, and R has several tools for that</p>
</div>
<div id="evaluate-model-fit" class="section level2">
<h2>Evaluate model fit</h2>
<p>Let’s call the summary function again to talk about another part of the output:</p>
<pre class="r"><code>summary(region_model)</code></pre>
<pre><code>## 
## Call:
## lm(formula = new_cases ~ world_region, data = covid_small)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -10784.4   -536.8   -311.7    -39.6  10784.4 
## 
## Coefficients:
##                                             Estimate Std. Error t value
## (Intercept)                                    62.97     290.34   0.217
## world_regionAsia and the Pacific              327.72     464.14   0.706
## world_regionEurope                            501.52     418.42   1.199
## world_regionLatin America and the Caribbean   689.28     459.06   1.501
## world_regionNorth America                   11872.23    1361.80   8.718
## world_regionWest Asia                         502.81     662.07   0.759
##                                             Pr(&gt;|t|)    
## (Intercept)                                    0.829    
## world_regionAsia and the Pacific               0.481    
## world_regionEurope                             0.233    
## world_regionLatin America and the Caribbean    0.135    
## world_regionNorth America                   6.76e-15 ***
## world_regionWest Asia                          0.449    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1882 on 142 degrees of freedom
## Multiple R-squared:  0.3502, Adjusted R-squared:  0.3273 
## F-statistic:  15.3 on 5 and 142 DF,  p-value: 5.082e-12</code></pre>
<p>Another information given by <code>summary()</code> is the distribution of residuals. Residuals are the variation that cannot be explained by the model: the difference between what our model predicts and what we actually observe. For example, in the coefficients table we see that the coefficient estimated for Africa (the model intercept) is 62.97. So the model estimates that an African country would have an average of 62.97 new cases of covid19 now. Let’s look at how many cases they actually have by plotting each country as a point.</p>
<p>We will use ggplot this time since it is more flexible. For example, instead of transforming the data we can tell it to use a transformation of <em>log plus one</em> for the y axis. We will also plot a straight line at the intercept, which is the inference for Africa, so we can compare the distribution of points.</p>
<p>Let’s first load the package.</p>
<pre class="r"><code>library(ggplot2)</code></pre>
<p>And now we can plot.</p>
<pre class="r"><code>Africa_only &lt;- covid_small[covid_small$world_region ==&#39;Africa&#39;, ]

ggplot(Africa_only) +
  geom_point(aes(x = world_region, y = new_cases)) +
  scale_y_continuous(trans=&#39;log1p&#39;, breaks = c(1,10,100)) +
  geom_hline(yintercept = 62.97, color = &#39;red&#39;)</code></pre>
<p><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<p>Here we can see two things:</p>
<ol style="list-style-type: decimal">
<li>We slightly overstimated the number of cases for Africa</li>
<li>There is a large variation within Africa. The differences between an actual African country and our estimate are the residuals.</li>
</ol>
<p>In a typical linear model, we assume that the residuals should be normally distributed, and that they follow the same distribution across all the data. In out case, it means that the residuals should be more or less the same for all world regions. Is that the case? R has a simple function to calculate residuals, named <code>resid()</code>:</p>
<pre class="r"><code>residuals &lt;- resid(region_model)</code></pre>
<p>We saved the result of <code>resid(region_model)</code> in the object <code>residuals</code>, which is a vector with residual values:</p>
<pre class="r"><code>str(residuals)</code></pre>
<pre><code>##  Named num [1:148] -752.25 9.31 -62.37 -554.89 160.82 ...
##  - attr(*, &quot;names&quot;)= chr [1:148] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...</code></pre>
<p>The result of this function is a vector that shows the residuals for each one of our data points. Let’s build a data.frame with our data and residuals to visualize if our assumptions about residuals hold:</p>
<pre class="r"><code>resid_df &lt;- data.frame(world_region = covid_small$world_region, residual = residuals)</code></pre>
<p>Let’s look at histograms of our residuals for each world region now:</p>
<pre class="r"><code>ggplot(resid_df)+
  geom_histogram(aes(x=residuals)) +
  facet_wrap(~world_region,ncol = 2)</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<p>The residuals do not look normally distribued, and also not the same for all regions!</p>
<p>We did all this to get an intuition about how we evaluate model fit, but R has nice function to help us understand whether the model assumption holds. If we give our model as input to the function <code>plot()</code>, it will return a series of graphs:</p>
<pre class="r"><code>plot(region_model)</code></pre>
<p><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-32-1.png" width="672" /><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-32-2.png" width="672" /><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-32-3.png" width="672" /><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-32-4.png" width="672" /></p>
<ol style="list-style-type: decimal">
<li><p>The first graph shows our fitted values (i. e., model predictions) against residuals. It seems the dispersion of residuals is increasing with increased fitted values. The average trend (red line) is decreasing. In a good model, there should be no trend and the variance should be constant.</p></li>
<li><p>The second graph is a Q-Q plot and compares our residuals to what would be expected if they were normally distributed. For a good model, it should be a straight line with slope of 1. This is far from what we are observing</p></li>
<li><p>The third graph is similar to the first one, but the y axis is the square root of residuals, with sign removed. Again, it indicates that the variation in residuals is increasing with higher predicted response</p></li>
<li><p>the fourth graphs helps to identify outliers, which are the labelled points farthest from the dashed region, and happen to be data points 22, 28 and 153. Which countries are these? These labels are the <strong>row names</strong>, not <strong>row numbers</strong>, so we need to provide a character vector to index them:</p></li>
</ol>
<pre class="r"><code>covid_small$country_name[c(&#39;22&#39;,&#39;28&#39;,&#39;153&#39;)]</code></pre>
<pre><code>## [1] &lt;NA&gt; &lt;NA&gt; &lt;NA&gt;
## 160 Levels: Afghanistan Albania Algeria Andorra Angola Argentina ... Zimbabwe</code></pre>
<p>This is saying that these three data points are the ones that are most influencing the model. we might consider removing them if we can’t build a good model at all.</p>
<p>But before doing that, it seems we can improve our model by log-transforming the response variable. When variation in residuals increases with fitted values, this can often help.</p>
<p>Let’s try this.</p>
<pre class="r"><code>region_model_log &lt;- lm(formula = log(new_cases) ~ world_region, data = covid_small)</code></pre>
<pre><code>## Error in lm.fit(x, y, offset = offset, singular.ok = singular.ok, ...): NA/NaN/Inf in &#39;y&#39;</code></pre>
<p>Oops, we got an error. This is because some countries have a number of cases of 0, so we cannot calculate the log. As we did with the graph, we can do a slightly different transformation and add 1 to all countries:</p>
<pre class="r"><code>region_model_log &lt;- lm(formula = log(new_cases+1) ~ world_region, data = covid_small)</code></pre>
<p>Now let’s plot the model to check the model fit:</p>
<pre class="r"><code>plot(region_model_log)</code></pre>
<p><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-36-1.png" width="672" /><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-36-2.png" width="672" /><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-36-3.png" width="672" /><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-36-4.png" width="672" /></p>
<p>It seems much better! The variation in residuals seems more or less constant across fitted values, the q-q plot is closer to a straight line and there are no points outside the dashed region in the last plot.</p>
<p>Has this log transformation changed anything about our estimates? Let’s use summary to figure out:</p>
<pre class="r"><code>summary(region_model_log)</code></pre>
<pre><code>## 
## Call:
## lm(formula = log(new_cases + 1) ~ world_region, data = covid_small)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4.0715 -2.1173 -0.0149  1.7933  5.8240 
## 
## Coefficients:
##                                             Estimate Std. Error t value
## (Intercept)                                   2.5873     0.3584   7.219
## world_regionAsia and the Pacific              0.9848     0.5730   1.719
## world_regionEurope                            1.6666     0.5165   3.226
## world_regionLatin America and the Caribbean   0.9039     0.5667   1.595
## world_regionNorth America                     5.9528     1.6811   3.541
## world_regionWest Asia                         2.5359     0.8173   3.103
##                                             Pr(&gt;|t|)    
## (Intercept)                                 2.91e-11 ***
## world_regionAsia and the Pacific             0.08784 .  
## world_regionEurope                           0.00156 ** 
## world_regionLatin America and the Caribbean  0.11295    
## world_regionNorth America                    0.00054 ***
## world_regionWest Asia                        0.00231 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.323 on 142 degrees of freedom
## Multiple R-squared:  0.147,  Adjusted R-squared:  0.1169 
## F-statistic: 4.892 on 5 and 142 DF,  p-value: 0.000368</code></pre>
<p>Now we gained much more power to find the differences. It seems most regions are different from Africa, with Latin America and Caribbean being more similar. Also notice that the estimates are different, because now we are modeling the log-transformed covid19 cases. This is not important now, but will be for prediction, which we will see below.</p>
<p>Before proceeding, let’s note that the choice of intercept for categorical variables is arbitrary. R chooses one arbitrary level in a factor as the intercept. To choose the baseline comparison yourself, you can explicitly set the reference level. Let’s set <code>Latin America and the Caribbean</code> using the function <code>relevel()</code>:</p>
<pre class="r"><code>covid_small$world_region &lt;- relevel(covid_small$world_region,
                                    ref = &#39;Latin America and the Caribbean&#39; )</code></pre>
<p>Now let’s fit a new model and print the summary. Latin America will be the intercept and all comparisons will be done in relation to it. Remember: this makes no difference for model predictions or for model test (which we will see below), just for which contrasts are displayed here!</p>
<pre class="r"><code>region_model_log &lt;- lm(formula = log(new_cases+1) ~ world_region, data = covid_small)

summary(region_model_log)</code></pre>
<pre><code>## 
## Call:
## lm(formula = log(new_cases + 1) ~ world_region, data = covid_small)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4.0715 -2.1173 -0.0149  1.7933  5.8240 
## 
## Coefficients:
##                                  Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)                       3.49119    0.43898   7.953 5.18e-13 ***
## world_regionAfrica               -0.90389    0.56671  -1.595   0.1129    
## world_regionAsia and the Pacific  0.08093    0.62653   0.129   0.8974    
## world_regionEurope                0.76267    0.57537   1.326   0.1871    
## world_regionNorth America         5.04887    1.70014   2.970   0.0035 ** 
## world_regionWest Asia             1.63200    0.85572   1.907   0.0585 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.323 on 142 degrees of freedom
## Multiple R-squared:  0.147,  Adjusted R-squared:  0.1169 
## F-statistic: 4.892 on 5 and 142 DF,  p-value: 0.000368</code></pre>
<p>While <code>summary()</code> is a good function to display model results in R, it does not produce results that we can save as a csv and open, for example, in Excel to make a nice table for a paper. The R package <code>broom</code> contains functions to do that. Let’s load this package and use the function tidy to see the results. Remeber to install the package broom with <code>install.packages('broom')</code> if you do not have it already.</p>
<pre class="r"><code>library(broom)
tidy(region_model_log)</code></pre>
<pre><code>## # A tibble: 6 x 5
##   term                             estimate std.error statistic  p.value
##   &lt;chr&gt;                               &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)                        3.49       0.439     7.95  5.18e-13
## 2 world_regionAfrica                -0.904      0.567    -1.59  1.13e- 1
## 3 world_regionAsia and the Pacific   0.0809     0.627     0.129 8.97e- 1
## 4 world_regionEurope                 0.763      0.575     1.33  1.87e- 1
## 5 world_regionNorth America          5.05       1.70      2.97  3.50e- 3
## 6 world_regionWest Asia              1.63       0.856     1.91  5.85e- 2</code></pre>
<p>Much better for saving! Let’s now assign this table to a variable and save it so we can open in Excel later.</p>
<pre class="r"><code>nice_table &lt;- tidy(region_model_log)
write.csv(nice_table, file = &#39;nice_table.csv&#39;)</code></pre>
</div>
<div id="model-choice" class="section level2">
<h2>Model choice</h2>
<p>Now that we used a transformation and made sure that the model fits the normality assumption, we have one more step: to show that we need to consider region at all. It could be the case that differences between some regions exist only by chance, and that a single normal distribution without considering world region could adequately explain our data. To test whether this is the case, we will use the function <code>drop1()</code>, which will try to remove predictors from our model and test if the result is a better model:</p>
<pre class="r"><code>drop1(region_model_log)</code></pre>
<pre><code>## Single term deletions
## 
## Model:
## log(new_cases + 1) ~ world_region
##              Df Sum of Sq    RSS    AIC
## &lt;none&gt;                    766.17 255.34
## world_region  5    131.99 898.16 268.86</code></pre>
<p>The function <code>drop1</code> tries to remove each predictor from the model (in our case, it was just one!) and then calculates the <a href="https://en.wikipedia.org/wiki/Akaike_information_criterion">Akaike Information Criteria (AIC)</a>, which is a statistic that tries to balance model complexity with explanatory power. The lower the value of AIC, the better a model is. Differences of AIC of 2 or more are typically considered very strong. What the table is saying here is that not removing any predictor (<none>) results in a much better model than removing <code>world_region</code>.</p>
<p>Another way to test whether a predictor is important is by doing an <a href="https://en.wikipedia.org/wiki/F-test">F test</a>, using the function <code>anova()</code>:</p>
<pre class="r"><code>anova(region_model_log)</code></pre>
<pre><code>## Analysis of Variance Table
## 
## Response: log(new_cases + 1)
##               Df Sum Sq Mean Sq F value   Pr(&gt;F)    
## world_region   5 131.99 26.3971  4.8923 0.000368 ***
## Residuals    142 766.17  5.3956                     
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Here the F-test resulted in a very small p-value for <code>world_region</code>, indicating that this term significantly improves the model.</p>
<p>Usually both methods will have similar results, but they might differ when the p-value is close to 0.05.</p>
<p>We can also do the F-test and calculate AICs at the same time by providing an additional argument to <code>drop1()</code>:</p>
<pre class="r"><code>drop1(region_model_log, test = &#39;F&#39;)</code></pre>
<pre><code>## Single term deletions
## 
## Model:
## log(new_cases + 1) ~ world_region
##              Df Sum of Sq    RSS    AIC F value   Pr(&gt;F)    
## &lt;none&gt;                    766.17 255.34                     
## world_region  5    131.99 898.16 268.86  4.8923 0.000368 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
<div id="ordered-categorical-variables-and-continuous-variables" class="section level2">
<h2>Ordered categorical variables and continuous variables</h2>
<p>We saw above an example using a categorical variable as predictor, but we can also use ordered factors. For example, workplace closing:</p>
<pre class="r"><code>str(covid_small$work_close)</code></pre>
<pre><code>##  Ord.factor w/ 4 levels &quot;none&quot;&lt;&quot;recommend&quot;&lt;..: 4 4 3 3 3 3 3 3 4 1 ...</code></pre>
<p>Let’s plot the relationship between both, log-transforming the number of cases:</p>
<pre class="r"><code>plot(formula = log10(new_cases+1) ~ work_close, data = covid_small)</code></pre>
<p><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-46-1.png" width="672" /></p>
<p>Maybe it has an effect, but not clear. It seems that this is a non-linear relationship that increases up until some point and then decreases.</p>
<pre class="r"><code>model_work &lt;- lm(formula = new_cases ~ work_close, data = covid_small)</code></pre>
<p>Let’s evaluate the model fit:</p>
<pre class="r"><code>plot(model_work)</code></pre>
<p><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-48-1.png" width="672" /><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-48-2.png" width="672" /><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-48-3.png" width="672" /><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-48-4.png" width="672" /></p>
<p>Model fit does not look good, let’s see if we can improve it with a log-transformation of the response variable:</p>
<pre class="r"><code>model_work_log &lt;- lm(formula = log(new_cases+1) ~ work_close, data = covid_small)

plot(model_work_log)</code></pre>
<p><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-49-1.png" width="672" /><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-49-2.png" width="672" /><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-49-3.png" width="672" /><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-49-4.png" width="672" /></p>
<p>Much better. Let’s look at the summary now:</p>
<pre class="r"><code>summary(model_work_log)</code></pre>
<pre><code>## 
## Call:
## lm(formula = log(new_cases + 1) ~ work_close, data = covid_small)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4.1163 -1.7015 -0.1385  1.7441  6.4731 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)    3.2259     0.2546  12.670  &lt; 2e-16 ***
## work_close.L   1.4585     0.4983   2.927  0.00398 ** 
## work_close.Q  -1.1923     0.5092  -2.342  0.02058 *  
## work_close.C  -0.2243     0.5199  -0.431  0.66677    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.388 on 144 degrees of freedom
## Multiple R-squared:  0.08592,    Adjusted R-squared:  0.06688 
## F-statistic: 4.512 on 3 and 144 DF,  p-value: 0.004677</code></pre>
<p>In the case of ordered factors, it is a little less intuitive to understand how R fits them, but basically they are treated as a number. Instead of fitting one parameter per factor level, it fits what we call a polynomial regression. <code>work_close.L</code> is the linear effect of travel control, indicating that the higher the stringency of workplace close orders, the lower the number of new cases. <code>work_close.Q</code> is the quadratic effect, which is negative, indicating a peak.<code>work_close.C</code> is the cubic effect, allowing the relationship between <code>work_close</code> and our response variable to be nonlinear.</p>
<p>Each estimated parameters is not as important for us now as whether travel control is important overall. For that, we use the function <code>drop1()</code>.</p>
<pre class="r"><code>drop1(model_work_log, test = &#39;F&#39;)</code></pre>
<pre><code>## Single term deletions
## 
## Model:
## log(new_cases + 1) ~ work_close
##            Df Sum of Sq    RSS    AIC F value   Pr(&gt;F)   
## &lt;none&gt;                  820.99 261.57                    
## work_close  3    77.172 898.16 268.86   4.512 0.004677 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>In this case, it seems that a model including workplace closings is much better than one that does not, and that closing workplaces generally increases the number of new coronavirus cases.</p>
<p>That seems counter-intuitive: does closing work places make the pandemics worse??? We will have a closer look in the next section.</p>
</div>
<div id="multiple-predictors" class="section level2">
<h2>Multiple predictors</h2>
<p>The last example will be useful for us to introduce fitting models with multiple predictors. We can imagine, for example, that the effect that we found could be spurious, and workplace restrictions are actually associated with another variable that is the true driver of new covid19 cases. For example, it could be that countries decided to close workplaces based on how severe covid19 was a month ago, and that the number of past cases is really the main factor explaining current trends.</p>
<p>We can fit a new regression including past cases as a predictor and test if, considering past cases, workplace closings are still important.</p>
<p>We can use ggplot to visualize the effect of both variables at the same time. The number of past cases will be the X axis, while work closures will be color-coded:</p>
<pre class="r"><code>ggplot(covid_small) +
  geom_point(aes(x = past_cases, y = new_cases, color = work_close)) +
  scale_x_continuous(trans = &#39;log1p&#39;, breaks = 10^(0:5)) +
  scale_y_continuous(trans = &#39;log1p&#39;, breaks = 10^(0:5)) </code></pre>
<p><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-52-1.png" width="672" /></p>
<p>With this plot, it now becomes clear that the number of new cases is determined by the number of past cases. It does not look like work closures have much influence other than that. More importantly, we should be cautious: all countries with more than 100 cases seem to have adopted some sort of workplace closure intervention, most of them with the more strict controls. That means that we will have little power to actually detect any effect of work closures! If this were an experiment, we should have better balanced the different treatments. Since this is not an experiment but rather observations, we will move on, knowing that this imbalance will impact our ability to detect differences.</p>
<p>Now we can fit the model, evaluate it and test with <code>drop1()</code>:</p>
<pre class="r"><code>model_work_past &lt;- lm(formula = log(new_cases+1) ~ log(past_cases+1) + work_close, 
                      data = covid_small)</code></pre>
<pre class="r"><code>plot(model_work_past)</code></pre>
<p><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-54-1.png" width="672" /><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-54-2.png" width="672" /><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-54-3.png" width="672" /><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-54-4.png" width="672" /></p>
<pre class="r"><code>drop1(model_work_past, test = &#39;F&#39;)</code></pre>
<pre><code>## Single term deletions
## 
## Model:
## log(new_cases + 1) ~ log(past_cases + 1) + work_close
##                     Df Sum of Sq    RSS     AIC  F value Pr(&gt;F)    
## &lt;none&gt;                           272.19 100.176                    
## log(past_cases + 1)  1    548.79 820.99 261.567 288.3172 &lt;2e-16 ***
## work_close           3      1.84 274.03  95.173   0.3224 0.8092    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>In this case, the lowest AIC is a model without work closures (notice that the table is NOT ordered by AIC). The F test also did not find a significant difference between a model deleting no variable and a model deleting <code>work_close</code>. Since they are not statistically different, we use the parsimony principle and keep the simpler model.</p>
<p>Now we will fit a new model, withut <code>work_close</code>, and do the test again to see if deleting <code>past_cases</code> improves the model further.</p>
<pre class="r"><code>model_pastonly &lt;- lm(formula = log(new_cases+1) ~ log(past_cases+1), data = covid_small)</code></pre>
<pre class="r"><code>drop1(model_pastonly, test = &#39;F&#39;)</code></pre>
<pre><code>## Single term deletions
## 
## Model:
## log(new_cases + 1) ~ log(past_cases + 1)
##                     Df Sum of Sq    RSS     AIC F value    Pr(&gt;F)    
## &lt;none&gt;                           274.03  95.173                      
## log(past_cases + 1)  1    624.13 898.16 268.864  332.52 &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Now the difference is significant: we cannot improve our model by removing any more terms.</p>
<p>We can now use <code>summary()</code>, <code>tidy()</code>, <code>plot()</code> and all functions shown above to the result of <code>step()</code>:</p>
<pre class="r"><code>summary(model_pastonly)</code></pre>
<pre><code>## 
## Call:
## lm(formula = log(new_cases + 1) ~ log(past_cases + 1), data = covid_small)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -2.83253 -0.97520  0.06853  1.03690  2.98861 
## 
## Coefficients:
##                     Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)          0.57470    0.20183   2.847  0.00504 ** 
## log(past_cases + 1)  0.87242    0.04784  18.235  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.37 on 146 degrees of freedom
## Multiple R-squared:  0.6949, Adjusted R-squared:  0.6928 
## F-statistic: 332.5 on 1 and 146 DF,  p-value: &lt; 2.2e-16</code></pre>
<pre class="r"><code>plot(model_pastonly)</code></pre>
<p><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-59-1.png" width="672" /><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-59-2.png" width="672" /><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-59-3.png" width="672" /><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-59-4.png" width="672" /></p>
<pre class="r"><code>tidy(model_pastonly)</code></pre>
<pre><code>## # A tibble: 2 x 5
##   term                estimate std.error statistic  p.value
##   &lt;chr&gt;                  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)            0.575    0.202       2.85 5.04e- 3
## 2 log(past_cases + 1)    0.872    0.0478     18.2  1.83e-39</code></pre>
<pre class="r"><code>tidy(drop1(model_pastonly))</code></pre>
<pre><code>## Warning in tidy.anova(drop1(model_pastonly)): The following column names in
## ANOVA output were not recognized or transformed: AIC</code></pre>
<pre><code>## # A tibble: 2 x 5
##   term                   df sumsq   rss   AIC
##   &lt;chr&gt;               &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 &lt;none&gt;                 NA   NA   274.  95.2
## 2 log(past_cases + 1)     1  624.  898. 269.</code></pre>
<p>So far we learnt to explore our data before fitting models, and then fitting and evaluating models, making transformations if needed. Finally, we learnt to simplify models and drop unnecessary terms. Now we will learn how to use these models to make predictions, and plot them.</p>
</div>
<div id="prediction" class="section level2">
<h2>Prediction</h2>
<p>We will finish our overview of linear models in R by using them for predictions. First, we will fit a new, very complex, model in which the current number of cases of covid19 depends on all variables that we kept on the dataset. We will also include an interaction between gdp per capita and income support, since the effect of support might be greater in poorer countries, for example. We will then do several rounds of <code>drop1()</code> and fitting a simpler model, until we are left only with the variables that are important in explaining variation of new cases across countries.</p>
<pre class="r"><code>covid_full_model &lt;- lm(formula = log(new_cases+1) ~ log(past_cases+1) +
                        gdp_per_capita*income_support +
                        stringency_idx +
                        work_close, 
                       data=covid_small)</code></pre>
<p>With many variables like this, it will be a lot of work to use <code>drop1()</code> several times, fit simpler models, and repeat. Luckily, R has a function that does that automatically, names <code>step()</code>. As the name indicates, <code>step()</code> does <code>drop1()</code> in steps.</p>
<pre class="r"><code>minimal_model &lt;- step(covid_full_model)</code></pre>
<pre><code>## Start:  AIC=90.71
## log(new_cases + 1) ~ log(past_cases + 1) + gdp_per_capita * income_support + 
##     stringency_idx + work_close
## 
##                                 Df Sum of Sq    RSS     AIC
## - work_close                     3      4.23 239.66  87.339
## &lt;none&gt;                                       235.44  90.706
## - stringency_idx                 1      4.62 240.06  91.581
## - gdp_per_capita:income_support  2      8.64 244.08  92.041
## - log(past_cases + 1)            1    532.18 767.62 263.620
## 
## Step:  AIC=87.34
## log(new_cases + 1) ~ log(past_cases + 1) + gdp_per_capita + income_support + 
##     stringency_idx + gdp_per_capita:income_support
## 
##                                 Df Sum of Sq    RSS     AIC
## - stringency_idx                 1      1.55 241.22  86.296
## &lt;none&gt;                                       239.66  87.339
## - gdp_per_capita:income_support  2      8.91 248.58  88.744
## - log(past_cases + 1)            1    560.37 800.03 263.741
## 
## Step:  AIC=86.3
## log(new_cases + 1) ~ log(past_cases + 1) + gdp_per_capita + income_support + 
##     gdp_per_capita:income_support
## 
##                                 Df Sum of Sq    RSS     AIC
## &lt;none&gt;                                       241.22  86.296
## - gdp_per_capita:income_support  2      8.03 249.24  87.140
## - log(past_cases + 1)            1    576.49 817.71 264.976</code></pre>
<p>Here, it first found that removing workplace closures improved the model, which we knew already. Then it removed several other predictors in the next steps of <code>drop1()</code>. In the last step, a model including number of past cases and the interaction between income support and gdp per capita was better than any model removing these variables, so we kept them.</p>
<p>Let’s have a look at the chosen model:</p>
<pre class="r"><code>plot(minimal_model)</code></pre>
<p><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-64-1.png" width="672" /><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-64-2.png" width="672" /><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-64-3.png" width="672" /><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-64-4.png" width="672" /></p>
<pre class="r"><code>summary(minimal_model)</code></pre>
<pre><code>## 
## Call:
## lm(formula = log(new_cases + 1) ~ log(past_cases + 1) + gdp_per_capita + 
##     income_support + gdp_per_capita:income_support, data = covid_small)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -3.3306 -0.8396 -0.0870  0.9145  3.1723 
## 
## Coefficients:
##                                   Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)                      2.715e-01  2.486e-01   1.092  0.27664    
## log(past_cases + 1)              9.827e-01  5.353e-02  18.357  &lt; 2e-16 ***
## gdp_per_capita                  -1.475e-05  6.322e-06  -2.333  0.02108 *  
## income_support.L                -1.106e+00  3.662e-01  -3.019  0.00301 ** 
## income_support.Q                -2.333e-01  2.929e-01  -0.797  0.42695    
## gdp_per_capita:income_support.L  2.350e-05  1.085e-05   2.165  0.03208 *  
## gdp_per_capita:income_support.Q -1.414e-06  1.012e-05  -0.140  0.88909    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.308 on 141 degrees of freedom
## Multiple R-squared:  0.7314, Adjusted R-squared:   0.72 
## F-statistic:    64 on 6 and 141 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>The summary indicates that the effect of income support alone is mostly linear: the higher the income support, the lower the number of current cases, after accounting for number of past cases. However, the interaction term indicates that if gdp per capita increases, the effect of income support is smaller: income support has a greater effect on poorer countries! It might be hard to understand the model behavior by looking at this table alone, so we will make it easier: let’s use the model to make predictions and then plot these predictions together with the data.</p>
<p>Let’s start by make predictions to compare to the data used to fit the model. We can achieve this with the function <code>predict()</code>. Let’s use <code>predict()</code> to obtain predictions and their associated error:</p>
<pre class="r"><code>prediction &lt;- predict(minimal_model, interval = &#39;prediction&#39;)</code></pre>
<pre><code>## Warning in predict.lm(minimal_model, interval = &quot;prediction&quot;): predictions on current data refer to _future_ responses</code></pre>
<pre class="r"><code>head(prediction)</code></pre>
<pre><code>##         fit        lwr      upr
## 1 0.6695544 -2.0094681 3.348577
## 2 4.8131704  2.1868262 7.439515
## 3 0.7722633 -1.8490491 3.393576
## 4 2.1703236 -0.5161315 4.856779
## 6 4.7016893  1.7994289 7.603950
## 7 4.6524578  2.0418860 7.263030</code></pre>
<p>Now we need to remember that we log-transformed the response variable (number of new covid19 cases) before fitting the model, so we need to do the inverse operation here so our prediction is in the original scale. The inverse function of <span class="math inline">\(log(x+1)\)</span> is <span class="math inline">\(exp(x)-1\)</span>.</p>
<pre class="r"><code>prediction_df = as.data.frame(exp(prediction)-1)

head(prediction_df)</code></pre>
<pre><code>##           fit        lwr        upr
## 1   0.9533668 -0.8659400   27.46220
## 2 122.1213442  7.9068999 1700.92386
## 3   1.1646600 -0.8426132   28.77222
## 4   7.7611190 -0.4031751  127.60925
## 6 109.1330581  5.0461935 2005.10358
## 7 103.8423464  6.7051274 1425.57182</code></pre>
<p>We can join this data.frame to the data used in the model fit by binding columns with <code>cbind()</code></p>
<pre class="r"><code>data_plus_pred = cbind(prediction_df, covid_small)

head(data_plus_pred)</code></pre>
<pre><code>##           fit        lwr        upr         country_name
## 1   0.9533668 -0.8659400   27.46220                Aruba
## 2 122.1213442  7.9068999 1700.92386          Afghanistan
## 3   1.1646600 -0.8426132   28.77222               Angola
## 4   7.7611190 -0.4031751  127.60925              Albania
## 6 109.1330581  5.0461935 2005.10358 United Arab Emirates
## 7 103.8423464  6.7051274 1425.57182            Argentina
##                      world_region new_cases past_cases gdp_per_capita
## 1 Latin America and the Caribbean       0.0        1.4      35973.781
## 2            Asia and the Pacific     400.0       52.6       1803.987
## 3                          Africa       0.6        0.0       5819.495
## 4                          Europe       9.6       15.6      11803.431
## 6                       West Asia     726.6      401.0      67293.483
## 7 Latin America and the Caribbean     338.0       91.4      18933.907
##     work_close income_support stringency_idx
## 1 require most           none          83.46
## 2 require most           none          76.33
## 3 require some           none          86.77
## 4 require some  more than 50%          88.36
## 6 require some           none          86.77
## 7 require some  less than 50%          87.57</code></pre>
<p>How good was our prediction for Panama, Brazil and the USA, for example?</p>
<pre class="r"><code>countries = c(&#39;Panama&#39;, &#39;Brazil&#39;, &#39;United States&#39;)

data_plus_pred[data_plus_pred$country_name %in% countries, c(&#39;lwr&#39;,&#39;fit&#39;,&#39;upr&#39;,&#39;new_cases&#39;,&#39;country_name&#39;)]</code></pre>
<pre><code>##           lwr        fit        upr new_cases  country_name
## 22  141.15920  1999.9313  28162.677   11104.8        Brazil
## 113  12.25588   182.4582   2538.018     164.0        Panama
## 153 923.24146 13542.7191 198466.971   22719.6 United States</code></pre>
<p>The number of cases is within the prediction interval, but the average is one order of magnitude wrong for Brazil.</p>
<p>We can also make predictions based on new data. This is useful to make nice plots including the data and model predictions, for example. Let’s try it out. First, we will figure out what is the range of the data we will plot.</p>
<pre class="r"><code>summary(covid_small$income_support)</code></pre>
<pre><code>##          none less than 50% more than 50% 
##            60            56            32</code></pre>
<pre class="r"><code>summary(covid_small$past_cases)</code></pre>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##     0.0     3.9    28.0   501.0   161.6 27620.8</code></pre>
<pre class="r"><code>summary(covid_small$gdp_per_capita)</code></pre>
<pre><code>##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
##    702.2   5288.6  13567.3  20588.0  31654.4 116935.6</code></pre>
<p>So we need to make predictions across the range of 0-27620 of new daily cases, for the 3 levels of income support. It would be hard to do that for all of the range of gdp per capita, so we will make predictions for two kinds of countries: a poor country with gdp per capita of US$ 5,000 per year and a rich country with gdp per capita of US$ 50,000 per year.</p>
<p>We need create a data.frame with all possible combinations for the values from all three variables, which we can do with the function <code>expand.grid()</code>. <code>expand.grid()</code> creates a new data frame with all possible combinations of the vectors provided.</p>
<pre class="r"><code>values_past_cases &lt;- seq(from = 0, to=27620, length.out = 1000)
values_income &lt;- levels(covid_small$income_support)

values_gdp &lt;- c(5000, 50000)

new_data &lt;- expand.grid(values_past_cases, values_income, values_gdp)

head(new_data)</code></pre>
<pre><code>##        Var1 Var2 Var3
## 1   0.00000 none 5000
## 2  27.64765 none 5000
## 3  55.29530 none 5000
## 4  82.94294 none 5000
## 5 110.59059 none 5000
## 6 138.23824 none 5000</code></pre>
<p>A side effect of <code>expand.grid()</code> is that ordered factors loose their order, so we need to use the function <code>factor()</code> to put the correct order back. This is important for plotting, since ggplot will automatically recognize the order and use an appropriate color scale.</p>
<pre class="r"><code>new_data$Var2 &lt;- factor(new_data$Var2, 
                       levels = levels(covid_small$income_support),
                       ordered = T)</code></pre>
<p>Now we have to rename our data.frame columns to match the model parameters, and to transform income support into a factor as it was originally.</p>
<pre class="r"><code>colnames(new_data) &lt;- c(&#39;past_cases&#39;, &#39;income_support&#39;,&#39;gdp_per_capita&#39;)

head(new_data)</code></pre>
<pre><code>##   past_cases income_support gdp_per_capita
## 1    0.00000           none           5000
## 2   27.64765           none           5000
## 3   55.29530           none           5000
## 4   82.94294           none           5000
## 5  110.59059           none           5000
## 6  138.23824           none           5000</code></pre>
<p>Now that we have the data.fame with new data, we can use it to predict. Let’s make the predictions and add them as new columns to the <code>new_data</code> data.frame after transforming back to the original scale</p>
<pre class="r"><code>prediction &lt;- predict(minimal_model, newdata = new_data, interval = &#39;prediction&#39;)
prediction &lt;- exp(prediction) - 1

new_data &lt;- cbind(new_data, prediction)

head(new_data)</code></pre>
<pre><code>##   past_cases income_support gdp_per_capita        fit        lwr        upr
## 1    0.00000           none           5000   1.222061 -0.8385641   29.58525
## 2   27.64765           none           5000  59.067018  3.3928636  820.34273
## 3   55.29530           none           5000 115.665759  7.4938184 1601.44764
## 4   82.94294           none           5000 171.764132 11.5332004 2380.47037
## 5  110.59059           none           5000 227.537685 15.5303396 3158.61287
## 6  138.23824           none           5000 283.070160 19.4950177 3936.34013</code></pre>
<p>Before plotting, let’s add a new column that will say if a country is rich or poor depending on the gdp per capita. We will call countries above 30,000 USD as rich and those below this as poor by using the function <code>ifelse()</code>. This function works similar to an <code>if{} else{}</code> statement, but it is a much shorter version for vectors. The function below means that the column <code>country_type</code> will have a value of <code>rich</code> if the country has a gdp per capita above 30000, and <code>poor</code> if not.</p>
<pre class="r"><code>new_data$country_type &lt;- ifelse(new_data$gdp_per_capita &gt; 30000,
                               &#39;rich&#39;,
                               &#39;poor&#39;)</code></pre>
<p>We will do the same for our real data.</p>
<pre class="r"><code>covid_small$country_type = ifelse(covid_small$gdp_per_capita &gt; 30000,
                               &#39;rich&#39;,
                               &#39;poor&#39;)</code></pre>
<p>Now we can use ggplot to plot the data and the predictions. Let’s start with the predictions. We will plot rich and poor countries as facets, income support as colors, past cases in the X axis and new cases in the Y axis as a line. Since we are using a line and not points, we need also to use the <code>group</code> aesthetics, to tell which points will be part of the same line</p>
<pre class="r"><code>p &lt;- ggplot(new_data) +
  geom_line(aes(x = past_cases, 
                 y = fit, 
                 color = income_support,
                 group = income_support)) +
  facet_wrap(~country_type)

p</code></pre>
<p><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-79-1.png" width="672" /></p>
<p>Looking at the prediction alone, it seems that for poor countries the higher the income support, the lower the increase in number of new cases during the last month. The effect is smaller for rich countries.</p>
<p>Now let’s add the real data. Remember that since we assigned our plot to the variable <code>p</code>, we can add a new plot layer by adding a <code>geom_</code> to <code>p</code>. Let’s add points, and indicate the the data comes from <code>covid_small</code>.</p>
<pre class="r"><code>p &lt;- p +
  geom_point(aes(x = past_cases, 
                 y = new_cases, 
                 color = income_support,
                 group = income_support), 
             data = covid_small) 

p</code></pre>
<p><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-80-1.png" width="672" /></p>
<p>Oops, it is hard to visualize the data. Let’s transform scales to a <code>log1p</code> scale for better visualizing:</p>
<pre class="r"><code>p &lt;- p +
  scale_x_continuous(trans = &#39;log1p&#39;, breaks = 10^(0:5)) +
  scale_y_continuous(trans = &#39;log1p&#39;, breaks = 10^(0:5))

p</code></pre>
<p><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-81-1.png" width="672" /></p>
<p>With this plot, a few things stand out:</p>
<ol style="list-style-type: decimal">
<li><p>There is quite a lot of variation in the degree of income support across countries, which might have played a role in the power that we had to detect a relationship.</p></li>
<li><p>There is some degree of correlation between gdp per capita and income support: a larger share of rich countries seem to have done it, when compared to poor countries. That said, there is variation in both classes.</p></li>
<li><p>We should be careful when interpreting results. It does not mean that international travel control does not work, for example. Since most countries implemented some degree of control, it might be the case that we just do not have enough variation to test whether it works or not. This is one of the limitations of observational data in comparison to experiments!</p></li>
</ol>
<p>Finally, we can embellish the plot with nice labels and a nice theme. We will also add a 1:1 dashed line which will indicate which countries increased and which decreased cases with <code>geom_abline()</code>. Points below the dashed line decreased in cases in the last 30 days, and it is pretty clear that income support brings more points below the line:</p>
<pre class="r"><code>p +
  theme_minimal() +
  labs(y = &#39;Average new cases in the past 5 days&#39;,
       x = &#39;Average new cases a month ago&#39;,
       title = &#39;Growth of COVID19 across countries&#39;, 
       subtitle = &#39;Income decreases cases of COVID19&#39;) +
  geom_abline(intercept = 0,slope = 1,linetype=&#39;dashed&#39;) +
  coord_equal()</code></pre>
<p><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-82-1.png" width="672" /></p>
<p>This concludes our tutorial on linear models. There is a lot more that can be done in R for more complex models, but they all use similar functions to the ones we used here. To learn more, check the following:</p>
<ul>
<li><p>Generalized linear models: function <code>glm</code>.</p></li>
<li><p>Time Series: <a href="https://cran.r-project.org/web/views/TimeSeries.html">several packages</a>.</p></li>
<li><p>Mixed models: <a href="https://bbolker.github.io/mixedmodels-misc/MixedModels.html">several packages</a></p></li>
<li><p>Linear models accounting for phylogeny: <a href="https://cran.r-project.org/web/views/Phylogenetics.html">several packages</a></p></li>
<li><p>Bayesian models: <a href="https://cran.r-project.org/web/packages/rstanarm/index.html">rstanarm</a> for an easy interface similar to the one we used here.</p></li>
</ul>
</div>
</div>
<div id="clustering-and-ordination" class="section level1">
<h1>Clustering and ordination</h1>
<p>R is also a great tool to work with multivariate data, which we typically find in community ecology, for example. A common analysis with this kind of data is clustering and ordination. In our context here, we can ask ourselves how countries differ overall in the kind of interventions that they have taken against covid19, and whether countries in the same region tend to be more similar. We will use a method known as ‘nonmetric multidimensional scaling’ to visualize that, and an analysis of variance based on permutation (PERMANOVA) to test if kinds of measures differ by world region.</p>
<p>Let’s start by reading a new data.frame including only columns for country interventions against covid19, world regions and country names. This is a smaller version of the full data, in which we removed interventions with too much missing data</p>
<pre class="r"><code>covid_interventions &lt;- read.csv(&#39;covid_interventions_2020-05-16.csv&#39;, row.names = 1)
head(covid_interventions)</code></pre>
<pre><code>##                      world_region         country_name C1_School.closing
## 1 Latin America and the Caribbean                Aruba                 3
## 2            Asia and the Pacific          Afghanistan                 3
## 3                          Africa               Angola                 3
## 4                          Europe              Albania                 3
## 5                          Europe              Andorra                 3
## 6                       West Asia United Arab Emirates                 3
##   C1_Flag C2_Workplace.closing C3_Cancel.public.events C3_Flag
## 1       1                    3                       2       1
## 2       1                    3                       2       1
## 3       1                    2                       2       1
## 4       1                    2                       2       1
## 5       1                    2                       1       1
## 6       1                    2                       2       1
##   C4_Restrictions.on.gatherings C5_Close.public.transport
## 1                             4                         0
## 2                             4                         2
## 3                             4                         1
## 4                             4                         2
## 5                             0                         1
## 6                             4                         1
##   C6_Stay.at.home.requirements C7_Restrictions.on.internal.movement
## 1                            2                                    2
## 2                            2                                    2
## 3                            2                                    2
## 4                            2                                    2
## 5                            1                                    0
## 6                            2                                    1
##   C8_International.travel.controls E1_Income.support E2_Debt.contract.relief
## 1                                3                 0                       2
## 2                                1                 0                       0
## 3                                4                 0                       2
## 4                                4                 2                       1
## 5                                3                 2                       0
## 6                                4                 0                       2
##   H1_Public.information.campaigns H1_Flag H2_Testing.policy H3_Contact.tracing
## 1                               2       1                 1                  0
## 2                               2       1                 1                  1
## 3                               1       1                 2                  0
## 4                               2       1                 2                  1
## 5                               2       1                 3                  1
## 6                               2       1                 3                  2
##   H4_Emergency.investment.in.healthcare H5_Investment.in.vaccines
## 1                                     0                         0
## 2                                     0                         0
## 3                                     0                         0
## 4                                     0                         0
## 5                                     0                         0
## 6                                     0                         0</code></pre>
<p>The first step to do an ordination is to transform this table with several variables a summary with how different each country is from each other overall. In ecology, this would be the <span class="math inline">\(\beta\)</span> diversity, but here we will calculate Euclidean distances. This can be done with the R function <code>dist()</code>. For ecology, the package <code>ecodist</code> has functions to calculate several kinds of distance metrics.</p>
<p>The differences between all countries (ignoring columns with country names and regions) are:</p>
<pre class="r"><code>intervention_differences &lt;- dist(covid_interventions[,-c(1,2)])</code></pre>
<p>If we look at this object now, we find that it is an object of the class <code>dist</code>, that records the pairwise distances between all 147 countries (10731 distances total)</p>
<pre class="r"><code>str(intervention_differences)</code></pre>
<pre><code>##  &#39;dist&#39; num [1:10731] 3.61 2.24 3.61 6.08 3.46 ...
##  - attr(*, &quot;Size&quot;)= int 147
##  - attr(*, &quot;Labels&quot;)= chr [1:147] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
##  - attr(*, &quot;Diag&quot;)= logi FALSE
##  - attr(*, &quot;Upper&quot;)= logi FALSE
##  - attr(*, &quot;method&quot;)= chr &quot;euclidean&quot;
##  - attr(*, &quot;call&quot;)= language dist(x = covid_interventions[, -c(1, 2)])</code></pre>
<p>We will now use <a href="https://en.wikipedia.org/wiki/Multidimensional_scaling">nonmetric multidimensional scaling</a> (NMDS) to reduce this distance matrix of 147$$147 to only 2 dimensions, that we humans can look at in a graph. NMDS will attempt to represent the distances betwen all points in these two dimensions as well as possible.</p>
<p>The R package <code>vegan()</code> contains several functions to work with multivariate data, including one to do MDS. Let’s load the package first and remembet to install it with <code>install.packages('vegan')</code> in case you do not have it in your library already.</p>
<pre class="r"><code>library(vegan)</code></pre>
<pre><code>## Loading required package: permute</code></pre>
<pre><code>## Loading required package: lattice</code></pre>
<pre><code>## This is vegan 2.5-6</code></pre>
<p>The function to do NMDS is <code>metaMDS</code>:</p>
<pre class="r"><code>mds &lt;- metaMDS(intervention_differences)</code></pre>
<pre><code>## Run 0 stress 0.2121924 
## Run 1 stress 0.2108269 
## ... New best solution
## ... Procrustes: rmse 0.02365216  max resid 0.2587511 
## Run 2 stress 0.2111373 
## ... Procrustes: rmse 0.03826848  max resid 0.3671035 
## Run 3 stress 0.2303788 
## Run 4 stress 0.2186277 
## Run 5 stress 0.2104019 
## ... New best solution
## ... Procrustes: rmse 0.04125284  max resid 0.3850763 
## Run 6 stress 0.2126274 
## Run 7 stress 0.2126199 
## Run 8 stress 0.211299 
## Run 9 stress 0.2126195 
## Run 10 stress 0.2211411 
## Run 11 stress 0.2115133 
## Run 12 stress 0.2126201 
## Run 13 stress 0.2167959 
## Run 14 stress 0.2126322 
## Run 15 stress 0.2167862 
## Run 16 stress 0.2126338 
## Run 17 stress 0.212686 
## Run 18 stress 0.2113348 
## Run 19 stress 0.2122625 
## Run 20 stress 0.2115375 
## *** No convergence -- monoMDS stopping criteria:
##      1: no. of iterations &gt;= maxit
##     19: stress ratio &gt; sratmax</code></pre>
<p>We can use <code>plot</code> to visualize the results now:</p>
<pre class="r"><code>plot(mds)</code></pre>
<pre><code>## species scores not available</code></pre>
<p><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-88-1.png" width="672" /></p>
<p>If we want to color by world region, we can combine the points from the mds result with our column for country names and regions. The object <code>mds</code>, to which we assigned MDS results, holds the data frame with points under a slot named <code>points</code>. So here, with <code>mds$points</code> we can retrieve it.</p>
<pre class="r"><code>mds_result &lt;- cbind(mds$points, covid_interventions)

head(mds_result)</code></pre>
<pre><code>##         MDS1       MDS2                    world_region         country_name
## 1 -1.2509728  0.7370459 Latin America and the Caribbean                Aruba
## 2 -1.1768616 -1.8959121            Asia and the Pacific          Afghanistan
## 3 -0.7618385  0.3276026                          Africa               Angola
## 4 -0.5532353 -0.1306257                          Europe              Albania
## 5  3.5360182 -0.7589061                          Europe              Andorra
## 6 -0.5299589  0.6126979                       West Asia United Arab Emirates
##   C1_School.closing C1_Flag C2_Workplace.closing C3_Cancel.public.events
## 1                 3       1                    3                       2
## 2                 3       1                    3                       2
## 3                 3       1                    2                       2
## 4                 3       1                    2                       2
## 5                 3       1                    2                       1
## 6                 3       1                    2                       2
##   C3_Flag C4_Restrictions.on.gatherings C5_Close.public.transport
## 1       1                             4                         0
## 2       1                             4                         2
## 3       1                             4                         1
## 4       1                             4                         2
## 5       1                             0                         1
## 6       1                             4                         1
##   C6_Stay.at.home.requirements C7_Restrictions.on.internal.movement
## 1                            2                                    2
## 2                            2                                    2
## 3                            2                                    2
## 4                            2                                    2
## 5                            1                                    0
## 6                            2                                    1
##   C8_International.travel.controls E1_Income.support E2_Debt.contract.relief
## 1                                3                 0                       2
## 2                                1                 0                       0
## 3                                4                 0                       2
## 4                                4                 2                       1
## 5                                3                 2                       0
## 6                                4                 0                       2
##   H1_Public.information.campaigns H1_Flag H2_Testing.policy H3_Contact.tracing
## 1                               2       1                 1                  0
## 2                               2       1                 1                  1
## 3                               1       1                 2                  0
## 4                               2       1                 2                  1
## 5                               2       1                 3                  1
## 6                               2       1                 3                  2
##   H4_Emergency.investment.in.healthcare H5_Investment.in.vaccines
## 1                                     0                         0
## 2                                     0                         0
## 3                                     0                         0
## 4                                     0                         0
## 5                                     0                         0
## 6                                     0                         0</code></pre>
<p>Now we can use ggplot to plot the points and color by region:</p>
<pre class="r"><code>ggplot(mds_result) +
  geom_point(aes(x = MDS1,
                 y = MDS2,
                 color = world_region))</code></pre>
<p><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-90-1.png" width="672" /></p>
<p>With ggplot, we can also add ellipses surrounding the points for each region. We use the aesthetics <code>group</code> because <code>stat_ellipse()</code> needs to know how to group the points. We also moved the aesthetics up to the <code>ggplot()</code> function so it is inherited by both geom_point() and stat_ellipse().</p>
<pre class="r"><code>ggplot(mds_result, aes(x = MDS1, y = MDS2, color = world_region, group = world_region)) +
  geom_point() +
  stat_ellipse() +
  scale_color_brewer(type=&#39;qual&#39;)</code></pre>
<pre><code>## Too few points to calculate an ellipse</code></pre>
<pre><code>## Warning: Removed 1 row(s) containing missing values (geom_path).</code></pre>
<p><img src="/courses/2020_stri_introR/tutorials/L4_Stats_files/figure-html/unnamed-chunk-91-1.png" width="672" /></p>
<p>We got a warning because <strong>North America</strong> only has two countries and therefore it is not possible to draw an ellipse.</p>
<p>Maybe there is some difference between countries, but it is not clear. Let’s test whether this is the case with with a permutational ANOVA. By using the distances between countries as our response and world regions as the predictor, we want to know whether world regions differ significantly in the interventions used against covid19. The function to do this analysis is <code>adonis2</code> in the package <code>vegan</code>, and it uses a formula similar to linear models:</p>
<pre class="r"><code>adonis2(intervention_differences ~ world_region, data = covid_interventions)</code></pre>
<pre><code>## Permutation test for adonis under reduced model
## Terms added sequentially (first to last)
## Permutation: free
## Number of permutations: 999
## 
## adonis2(formula = intervention_differences ~ world_region, data = covid_interventions)
##               Df SumOfSqs      R2      F Pr(&gt;F)    
## world_region   5    87.68 0.08315 2.5576  0.001 ***
## Residual     141   966.75 0.91685                  
## Total        146  1054.44 1.00000                  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>It seems there is a difference between regions!</p>
<p>To summarize, we used linear models to find that there is a difference between regions in the number of new covid19 in the last few days. With a PERMANOVA, we found also that there is a difference in the interventions that countries in different regions attempted.</p>
<p>With a more complex model including other variables beyond region, we found that the number of new covid19 cases can be well explained by the number of past cases, and that governments providing some sort of income to their population were more sucessful in reducing the number of new cases. This effect was stronger in poorer countries.</p>
<p>To find out more about multivariate analyses and methods for ordination applied to ecology, checkout the page <a href="https://cran.r-project.org/web/views/Environmetrics.html">linked here</a>.</p>
</div>
<div id="to-do" class="section level1">
<h1>To do</h1>
<ol style="list-style-type: decimal">
<li><p>As an exercise, try to select different columns from the full dataset <code>covid_data</code> and use linear models to find the effect of other variables (for example, population age or density, prevalence of diabetes, etc) on the number of cases. You can also try to change the response variable to the total number of cases instead of the daily cases.</p></li>
<li><p>Try to apply either linear models or ordination to another dataset. If you have ecology data, come to office hours and we can work together on how to use ordination with dissimilarity metrics that are appropriate to ecology.</p></li>
</ol>
</div>
<div id="appendix-producing-the-dataset" class="section level1">
<h1>Appendix: Producing the dataset</h1>
<p>Here we show how the dataset that we used in this tutorial was produced. It is the result of cleaning and merging three sources: a table including country-level covid19 cases and country demographic data, another table with country responses to covid19, and a table that includes information about countries, including in which continent they are in.</p>
<p>After merging this data in a single table, we saved it as the csv file that we used today.</p>
<div id="loading-and-cleaning-datasets" class="section level3">
<h3>Loading and cleaning datasets</h3>
<p>Let’s start by downloading the data. The covid19 data in <a href="https://ourworldindata.org/">Our World in Data</a> is updated daily, and we can get the most recent table directly from the link <a href="https://covid.ourworldindata.org/data/owid-covid-data.csv" class="uri">https://covid.ourworldindata.org/data/owid-covid-data.csv</a></p>
<p>In the previous tutorials, we have loaded datasets located in our computer, and we could in theory use a web browser to download the table first, and then load it to R. However, R allows us to load a file directly from the web if we provide a URL (i. e. a web address). This table is in the CSV format (i. e. comma-separated values), so we will use the function <code>read.csv()</code> to read it.</p>
<pre class="r"><code>country_covid &lt;- read.csv(&#39;https://covid.ourworldindata.org/data/owid-covid-data.csv&#39;)

head(country_covid)</code></pre>
<pre><code>##   iso_code location       date total_cases new_cases total_deaths new_deaths
## 1      ABW    Aruba 2020-03-13           2         2            0          0
## 2      ABW    Aruba 2020-03-20           4         2            0          0
## 3      ABW    Aruba 2020-03-24          12         8            0          0
## 4      ABW    Aruba 2020-03-25          17         5            0          0
## 5      ABW    Aruba 2020-03-26          19         2            0          0
## 6      ABW    Aruba 2020-03-27          28         9            0          0
##   total_cases_per_million new_cases_per_million total_deaths_per_million
## 1                  18.733                18.733                        0
## 2                  37.465                18.733                        0
## 3                 112.395                74.930                        0
## 4                 159.227                46.831                        0
## 5                 177.959                18.733                        0
## 6                 262.256                84.296                        0
##   new_deaths_per_million total_tests new_tests total_tests_per_thousand
## 1                      0          NA        NA                       NA
## 2                      0          NA        NA                       NA
## 3                      0          NA        NA                       NA
## 4                      0          NA        NA                       NA
## 5                      0          NA        NA                       NA
## 6                      0          NA        NA                       NA
##   new_tests_per_thousand new_tests_smoothed new_tests_smoothed_per_thousand
## 1                     NA                 NA                              NA
## 2                     NA                 NA                              NA
## 3                     NA                 NA                              NA
## 4                     NA                 NA                              NA
## 5                     NA                 NA                              NA
## 6                     NA                 NA                              NA
##   tests_units stringency_index population population_density median_age
## 1                         0.00     106766              584.8       41.2
## 2                        30.56     106766              584.8       41.2
## 3                        41.67     106766              584.8       41.2
## 4                        41.67     106766              584.8       41.2
## 5                        41.67     106766              584.8       41.2
## 6                        41.67     106766              584.8       41.2
##   aged_65_older aged_70_older gdp_per_capita extreme_poverty cvd_death_rate
## 1        13.085         7.452       35973.78              NA             NA
## 2        13.085         7.452       35973.78              NA             NA
## 3        13.085         7.452       35973.78              NA             NA
## 4        13.085         7.452       35973.78              NA             NA
## 5        13.085         7.452       35973.78              NA             NA
## 6        13.085         7.452       35973.78              NA             NA
##   diabetes_prevalence female_smokers male_smokers handwashing_facilities
## 1               11.62             NA           NA                     NA
## 2               11.62             NA           NA                     NA
## 3               11.62             NA           NA                     NA
## 4               11.62             NA           NA                     NA
## 5               11.62             NA           NA                     NA
## 6               11.62             NA           NA                     NA
##   hospital_beds_per_100k
## 1                     NA
## 2                     NA
## 3                     NA
## 4                     NA
## 5                     NA
## 6                     NA</code></pre>
<p>This dataset records, for each country and each date, a series of statistics on covid19 as well together with several other statistics about the country (such as population, age structure, etc). A full explanation of the dataset can be found in <a href="https://github.com/owid/covid-19-data/tree/master/public/data">this github repository</a> and an explanation of the fields included can be found <a href="https://github.com/owid/covid-19-data/blob/master/public/data/owid-covid-data-codebook.md">here</a>, which is copied below:</p>
<table>
<colgroup>
<col width="26%" />
<col width="47%" />
<col width="26%" />
</colgroup>
<thead>
<tr class="header">
<th>Column</th>
<th>Description</th>
<th>Source</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>iso_code</code></td>
<td>ISO 3166-1 alpha-3 – three-letter country codes</td>
<td>International Organization for Standardization</td>
</tr>
<tr class="even">
<td><code>location</code></td>
<td>Geographical location</td>
<td>Our World in Data</td>
</tr>
<tr class="odd">
<td><code>date</code></td>
<td>Date of observation</td>
<td>Our World in Data</td>
</tr>
<tr class="even">
<td><code>total_cases</code></td>
<td>Total confirmed cases of COVID-19</td>
<td>European Centre for Disease Prevention and Control</td>
</tr>
<tr class="odd">
<td><code>new_cases</code></td>
<td>New confirmed cases of COVID-19</td>
<td>European Centre for Disease Prevention and Control</td>
</tr>
<tr class="even">
<td><code>total_deaths</code></td>
<td>Total deaths attributed to COVID-19</td>
<td>European Centre for Disease Prevention and Control</td>
</tr>
<tr class="odd">
<td><code>new_deaths</code></td>
<td>New deaths attributed to COVID-19</td>
<td>European Centre for Disease Prevention and Control</td>
</tr>
<tr class="even">
<td><code>total_cases_per_million</code></td>
<td>Total confirmed cases of COVID-19 per 1,000,000 people</td>
<td>European Centre for Disease Prevention and Control</td>
</tr>
<tr class="odd">
<td><code>new_cases_per_million</code></td>
<td>New confirmed cases of COVID-19 per 1,000,000 people</td>
<td>European Centre for Disease Prevention and Control</td>
</tr>
<tr class="even">
<td><code>total_deaths_per_million</code></td>
<td>Total deaths attributed to COVID-19 per 1,000,000 people</td>
<td>European Centre for Disease Prevention and Control</td>
</tr>
<tr class="odd">
<td><code>new_deaths_per_million</code></td>
<td>New deaths attributed to COVID-19 per 1,000,000 people</td>
<td>European Centre for Disease Prevention and Control</td>
</tr>
<tr class="even">
<td><code>total_tests</code></td>
<td>Total tests for COVID-19</td>
<td>European Centre for Disease Prevention and Control</td>
</tr>
<tr class="odd">
<td><code>new_tests</code></td>
<td>New tests for COVID-19</td>
<td>European Centre for Disease Prevention and Control</td>
</tr>
<tr class="even">
<td><code>total_tests_per_thousand</code></td>
<td>Total tests for COVID-19 per 1,000 people</td>
<td>National government reports</td>
</tr>
<tr class="odd">
<td><code>new_tests_per_thousand</code></td>
<td>New tests for COVID-19 per 1,000 people</td>
<td>National government reports</td>
</tr>
<tr class="even">
<td><code>tests_units</code></td>
<td>Units used by the location to report its testing data</td>
<td>National government reports</td>
</tr>
<tr class="odd">
<td><code>population</code></td>
<td>Population in 2020</td>
<td>United Nations, Department of Economic and Social Affairs, Population Division, World Population Prospects: The 2019 Revision</td>
</tr>
<tr class="even">
<td><code>population_density</code></td>
<td>Number of people divided by land area, measured in square kilometers, most recent year available</td>
<td>World Bank – World Development Indicators, sourced from Food and Agriculture Organization and World Bank estimates</td>
</tr>
<tr class="odd">
<td><code>median_age</code></td>
<td>Median age of the population, UN projection for 2020</td>
<td>UN Population Division, World Population Prospects, 2017 Revision</td>
</tr>
<tr class="even">
<td><code>aged_65_older</code></td>
<td>Share of the population that is 65 years and older, most recent year available</td>
<td>World Bank – World Development Indicators, based on age/sex distributions of United Nations Population Division’s World Population Prospects: 2017 Revision</td>
</tr>
<tr class="odd">
<td><code>aged_70_older</code></td>
<td>Share of the population that is 70 years and older in 2015</td>
<td>United Nations, Department of Economic and Social Affairs, Population Division (2017), World Population Prospects: The 2017 Revision</td>
</tr>
<tr class="even">
<td><code>gdp_per_capita</code></td>
<td>Gross domestic product at purchasing power parity (constant 2011 international dollars), most recent year available</td>
<td>World Bank – World Development Indicators, source from World Bank, International Comparison Program database</td>
</tr>
<tr class="odd">
<td><code>extreme_poverty</code></td>
<td>Share of the population living in extreme poverty, most recent year available since 2010</td>
<td>World Bank – World Development Indicators, sourced from World Bank Development Research Group</td>
</tr>
<tr class="even">
<td><code>cvd_death_rate</code></td>
<td>Death rate from cardiovascular disease in 2017</td>
<td>Global Burden of Disease Collaborative Network, Global Burden of Disease Study 2017 Results</td>
</tr>
<tr class="odd">
<td><code>diabetes_prevalence</code></td>
<td>Diabetes prevalence (% of population aged 20 to 79) in 2017</td>
<td>World Bank – World Development Indicators, sourced from International Diabetes Federation, Diabetes Atlas</td>
</tr>
<tr class="even">
<td><code>female_smokers</code></td>
<td>Share of women who smoke, most recent year available</td>
<td>World Bank – World Development Indicators, sourced from World Health Organization, Global Health Observatory Data Repository</td>
</tr>
<tr class="odd">
<td><code>male_smokers</code></td>
<td>Share of men who smoke, most recent year available</td>
<td>World Bank – World Development Indicators, sourced from World Health Organization, Global Health Observatory Data Repository</td>
</tr>
<tr class="even">
<td><code>handwashing_facilities</code></td>
<td>Share of the population with basic handwashing facilities on premises, most recent year available</td>
<td>United Nations Statistics Division</td>
</tr>
<tr class="odd">
<td><code>hospital_beds_per_100k</code></td>
<td>Hospital beds per 100,000 people, most recent year available since 2010</td>
<td>OECD, Eurostat, World Bank, national government records and other sources</td>
</tr>
</tbody>
</table>
<p>Since we are interested in understanding whether government responses work, we have to join this dataset to another one including several responses of governments to covid19. The link to this second dataset can also be found in the <a href="https://ourworldindata.org/">Our World in Data web page</a>, which is this one: <a href="https://raw.githubusercontent.com/OxCGRT/covid-policy-tracker/master/data/OxCGRT_latest.csv" class="uri">https://raw.githubusercontent.com/OxCGRT/covid-policy-tracker/master/data/OxCGRT_latest.csv</a>. Again, we will use <code>read.csv()</code> to load the dataset to a table:</p>
<pre class="r"><code>country_response &lt;- read.csv(&#39;https://raw.githubusercontent.com/OxCGRT/covid-policy-tracker/master/data/OxCGRT_latest.csv&#39;)

head(country_response)</code></pre>
<pre><code>##   CountryName CountryCode     Date C1_School.closing C1_Flag
## 1       Aruba         ABW 20200101                 0      NA
## 2       Aruba         ABW 20200102                 0      NA
## 3       Aruba         ABW 20200103                 0      NA
## 4       Aruba         ABW 20200104                 0      NA
## 5       Aruba         ABW 20200105                 0      NA
## 6       Aruba         ABW 20200106                 0      NA
##   C2_Workplace.closing C2_Flag C3_Cancel.public.events C3_Flag
## 1                    0      NA                       0      NA
## 2                    0      NA                       0      NA
## 3                    0      NA                       0      NA
## 4                    0      NA                       0      NA
## 5                    0      NA                       0      NA
## 6                    0      NA                       0      NA
##   C4_Restrictions.on.gatherings C4_Flag C5_Close.public.transport C5_Flag
## 1                             0      NA                         0      NA
## 2                             0      NA                         0      NA
## 3                             0      NA                         0      NA
## 4                             0      NA                         0      NA
## 5                             0      NA                         0      NA
## 6                             0      NA                         0      NA
##   C6_Stay.at.home.requirements C6_Flag C7_Restrictions.on.internal.movement
## 1                            0      NA                                    0
## 2                            0      NA                                    0
## 3                            0      NA                                    0
## 4                            0      NA                                    0
## 5                            0      NA                                    0
## 6                            0      NA                                    0
##   C7_Flag C8_International.travel.controls E1_Income.support E1_Flag
## 1      NA                                0                 0      NA
## 2      NA                                0                 0      NA
## 3      NA                                0                 0      NA
## 4      NA                                0                 0      NA
## 5      NA                                0                 0      NA
## 6      NA                                0                 0      NA
##   E2_Debt.contract.relief E3_Fiscal.measures E4_International.support
## 1                       0                  0                        0
## 2                       0                  0                        0
## 3                       0                  0                        0
## 4                       0                  0                        0
## 5                       0                  0                        0
## 6                       0                  0                        0
##   H1_Public.information.campaigns H1_Flag H2_Testing.policy H3_Contact.tracing
## 1                               0      NA                 0                  0
## 2                               0      NA                 0                  0
## 3                               0      NA                 0                  0
## 4                               0      NA                 0                  0
## 5                               0      NA                 0                  0
## 6                               0      NA                 0                  0
##   H4_Emergency.investment.in.healthcare H5_Investment.in.vaccines M1_Wildcard
## 1                                     0                         0          NA
## 2                                     0                         0          NA
## 3                                     0                         0          NA
## 4                                     0                         0          NA
## 5                                     0                         0          NA
## 6                                     0                         0          NA
##   ConfirmedCases ConfirmedDeaths StringencyIndex StringencyIndexForDisplay
## 1             NA              NA               0                         0
## 2             NA              NA               0                         0
## 3             NA              NA               0                         0
## 4             NA              NA               0                         0
## 5             NA              NA               0                         0
## 6             NA              NA               0                         0
##   StringencyLegacyIndex StringencyLegacyIndexForDisplay GovernmentResponseIndex
## 1                     0                               0                       0
## 2                     0                               0                       0
## 3                     0                               0                       0
## 4                     0                               0                       0
## 5                     0                               0                       0
## 6                     0                               0                       0
##   GovernmentResponseIndexForDisplay ContainmentHealthIndex
## 1                                 0                      0
## 2                                 0                      0
## 3                                 0                      0
## 4                                 0                      0
## 5                                 0                      0
## 6                                 0                      0
##   ContainmentHealthIndexForDisplay EconomicSupportIndex
## 1                                0                    0
## 2                                0                    0
## 3                                0                    0
## 4                                0                    0
## 5                                0                    0
## 6                                0                    0
##   EconomicSupportIndexForDisplay
## 1                              0
## 2                              0
## 3                              0
## 4                              0
## 5                              0
## 6                              0</code></pre>
<p>This table is very similar to the other one, with country, date and several columns detailing the response of each country on a given day. The explanation for each variable is available in the dataset <a href="https://github.com/OxCGRT/covid-policy-tracker/blob/master/documentation/codebook.md">github repository</a>:</p>
<div id="containment-and-closure-policies" class="section level5">
<h5>Containment and closure policies</h5>
<table>
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
</colgroup>
<thead>
<tr class="header">
<th>ID</th>
<th>Name</th>
<th>Description</th>
<th>Measurement</th>
<th>Coding</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>C1</td>
<td><code>C1_School closing</code></td>
<td>Record closings of schools and universities</td>
<td>Ordinal scale</td>
<td>0 - no measures <br/>1 - recommend closing <br/>2 - require closing (only some levels or categories, eg just high school, or just public schools) <br/>3 - require closing all levels <br/>Blank - no data</td>
</tr>
<tr class="even">
<td></td>
<td><code>C1_Flag</code></td>
<td></td>
<td>Binary flag for geographic scope</td>
<td>0 - targeted <br/>1- general <br/>Blank - no data</td>
</tr>
<tr class="odd">
<td>C2</td>
<td><code>C2_Workplace closing</code></td>
<td>Record closings of workplaces</td>
<td>Ordinal scale</td>
<td>0 - no measures <br/>1 - recommend closing (or recommend work from home) <br/>2 - require closing (or work from home) for some sectors or categories of workers <br/>3 - require closing (or work from home) for all-but-essential workplaces (eg grocery stores, doctors) <br/>Blank - no data</td>
</tr>
<tr class="even">
<td></td>
<td><code>C2_Flag</code></td>
<td></td>
<td>Binary flag for geographic scope</td>
<td>0 - targeted <br/>1- general <br/>Blank - no data</td>
</tr>
<tr class="odd">
<td>C3</td>
<td><code>C3_Cancel public events</code></td>
<td>Record cancelling public events</td>
<td>Ordinal scale</td>
<td>0 - no measures <br/>1 - recommend cancelling <br/>2 - require cancelling <br/>Blank - no data</td>
</tr>
<tr class="even">
<td></td>
<td><code>C3_Flag</code></td>
<td></td>
<td>Binary flag for geographic scope</td>
<td>0 - targeted <br/>1- general <br/>Blank - no data</td>
</tr>
<tr class="odd">
<td>C4</td>
<td><code>C4_Restrictions on gatherings</code></td>
<td>Record limits on private gatherings</td>
<td>Ordinal scale</td>
<td>0 - no restrictions <br/>1 - restrictions on very large gatherings (the limit is above 1000 people) <br/>2 - restrictions on gatherings between 101-1000 people <br/>3 - restrictions on gatherings between 11-100 people <br/>4 - restrictions on gatherings of 10 people or less <br/>Blank - no data</td>
</tr>
<tr class="even">
<td></td>
<td><code>C4_Flag</code></td>
<td></td>
<td>Binary flag for geographic scope</td>
<td>0 - targeted <br/>1- general <br/>Blank - no data</td>
</tr>
<tr class="odd">
<td>C5</td>
<td><code>C5_Close public transport</code></td>
<td>Record closing of public transport</td>
<td>Ordinal scale</td>
<td>0 - no measures <br/>1 - recommend closing (or significantly reduce volume/route/means of transport available) <br/>2 - require closing (or prohibit most citizens from using it) <br/>Blank - no data</td>
</tr>
<tr class="even">
<td></td>
<td><code>C5_Flag</code></td>
<td></td>
<td>Binary flag for geographic scope</td>
<td>0 - targeted <br/>1- general <br/>Blank - no data</td>
</tr>
<tr class="odd">
<td>C6</td>
<td><code>C6_Stay at home requirements</code></td>
<td>Record orders to “shelter-in-place” and otherwise confine to the home</td>
<td>Ordinal scale</td>
<td>0 - no measures <br/>1 - recommend not leaving house <br/>2 - require not leaving house with exceptions for daily exercise, grocery shopping, and ‘essential’ trips <br/>3 - require not leaving house with minimal exceptions (eg allowed to leave once a week, or only one person can leave at a time, etc) <br/>Blank - no data</td>
</tr>
<tr class="even">
<td></td>
<td><code>C6_Flag</code></td>
<td></td>
<td>Binary flag for geographic scope</td>
<td>0 - targeted <br/>1- general <br/>Blank - no data</td>
</tr>
<tr class="odd">
<td>C7</td>
<td><code>C7_Restrictions on internal movement</code></td>
<td>Record restrictions on internal movement between cities/regions</td>
<td>Ordinal scale</td>
<td>0 - no measures <br/>1 - recommend not to travel between regions/cities <br/>2 - internal movement restrictions in place <br/>Blank - no data</td>
</tr>
<tr class="even">
<td></td>
<td><code>C7_Flag</code></td>
<td></td>
<td>Binary flag for geographic scope</td>
<td>0 - targeted <br/>1- general <br/>Blank - no data</td>
</tr>
<tr class="odd">
<td>C8</td>
<td><code>C8_International travel controls</code></td>
<td>Record restrictions on international travel <br/><br/>Note: this records policy for foreign travellers, not citizens</td>
<td>Ordinal scale</td>
<td>0 - no restrictions <br/>1 - screening arrivals <br/>2 - quarantine arrivals from some or all regions <br/>3 - ban arrivals from some regions <br/>4 - ban on all regions or total border closure <br/>Blank - no data</td>
</tr>
</tbody>
</table>
</div>
<div id="economic-policies" class="section level5">
<h5>Economic policies</h5>
<table>
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
</colgroup>
<thead>
<tr class="header">
<th>ID</th>
<th>Name</th>
<th>Description</th>
<th>Measurement</th>
<th>Coding</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>E1</td>
<td><code>E1_Income support</code> <br/>(for households)</td>
<td>Record if the government is providing direct cash payments to people who lose their jobs or cannot work. <br/><br/>Note: only includes payments to firms if explicitly linked to payroll/salaries</td>
<td>Ordinal scale</td>
<td>0 - no income support <br/>1 - government is replacing less than 50% of lost salary (or if a flat sum, it is less than 50% median salary) <br/>2 - government is replacing more than 50% of lost salary (or if a flat sum, it is greater than 50% median salary) <br/>Blank - no data</td>
</tr>
<tr class="even">
<td></td>
<td><code>E1_Flag</code></td>
<td></td>
<td>Binary flag for sectoral scope</td>
<td>0 - formal sector workers only <br/>1 - transfers to informal sector workers too <br/>Blank - no data</td>
</tr>
<tr class="odd">
<td>E2</td>
<td><code>E2_Debt/contract relief</code> <br/>(for households)</td>
<td>Record if the government is freezing financial obligations for households (eg stopping loan repayments, preventing services like water from stopping, or banning evictions)</td>
<td>Ordinal scale</td>
<td>0 - no debt/contract relief <br/>1 - narrow relief, specific to one kind of contract <br/>2 - broad debt/contract relief</td>
</tr>
<tr class="even">
<td>E3</td>
<td><code>E3_Fiscal measures</code></td>
<td>Announced economic stimulus spending <br/><br/>Note: only record amount additional to previously announced spending</td>
<td>USD</td>
<td>Record monetary value in USD of fiscal stimuli, includes any spending or tax cuts NOT included in E4, H4 or H5 <br/>0 - no new spending that day <br/>Blank - no data</td>
</tr>
<tr class="odd">
<td>E4</td>
<td><code>E4_International support</code></td>
<td>Announced offers of Covid-19 related aid spending to other countries <br/><br/>Note: only record amount additional to previously announced spending</td>
<td>USD</td>
<td>Record monetary value in USD <br/>0 - no new spending that day <br/>Blank - no data</td>
</tr>
</tbody>
</table>
</div>
<div id="health-system-policies" class="section level5">
<h5>Health system policies</h5>
<table>
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
</colgroup>
<thead>
<tr class="header">
<th>ID</th>
<th>Name</th>
<th>Description</th>
<th>Measurement</th>
<th>Coding</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>H1</td>
<td><code>H1_Public information campaigns</code></td>
<td>Record presence of public info campaigns</td>
<td>Ordinal scale</td>
<td>0 - no Covid-19 public information campaign <br/>1 - public officials urging caution about Covid-19 <br/>2- coordinated public information campaign (eg across traditional and social media) <br/>Blank - no data</td>
</tr>
<tr class="even">
<td></td>
<td><code>H1_Flag</code></td>
<td></td>
<td>Binary flag for geographic scope</td>
<td>0 - targeted <br/>1- general <br/>Blank - no data</td>
</tr>
<tr class="odd">
<td>H2</td>
<td><code>H2_Testing policy</code></td>
<td>Record government policy on who has access to testing <br/><br/>Note: this records policies about testing for current infection (PCR tests) not testing for immunity (antibody test)</td>
<td>Ordinal scale</td>
<td>0 - no testing policy <br/>1 - only those who both (a) have symptoms AND (b) meet specific criteria (eg key workers, admitted to hospital, came into contact with a known case, returned from overseas) <br/>2 - testing of anyone showing Covid-19 symptoms <br/>3 - open public testing (eg “drive through” testing available to asymptomatic people) <br/>Blank - no data</td>
</tr>
<tr class="even">
<td>H3</td>
<td><code>H3_Contact tracing</code></td>
<td>Record government policy on contact tracing after a positive diagnosis <br/><br/>Note: we are looking for policies that would identify all people potentially exposed to Covid-19; voluntary bluetooth apps are unlikely to achieve this</td>
<td>Ordinal scale</td>
<td>0 - no contact tracing <br/>1 - limited contact tracing; not done for all cases <br/>2 - comprehensive contact tracing; done for all identified cases</td>
</tr>
<tr class="odd">
<td>H4</td>
<td><code>H4_Emergency investment in healthcare</code></td>
<td>Announced short term spending on healthcare system, eg hospitals, masks, etc <br/><br/>Note: only record amount additional to previously announced spending</td>
<td>USD</td>
<td>Record monetary value in USD <br/>0 - no new spending that day <br/>Blank - no data</td>
</tr>
<tr class="even">
<td>H5</td>
<td><code>H5_Investment in vaccines</code></td>
<td>Announced public spending on Covid-19 vaccine development <br/><br/>Note: only record amount additional to previously announced spending</td>
<td>USD</td>
<td>Record monetary value in USD <br/>0 - no new spending that day <br/>Blank - no data</td>
</tr>
</tbody>
</table>
</div>
<div id="miscellaneous-policies" class="section level5">
<h5>Miscellaneous policies</h5>
<table>
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
</colgroup>
<thead>
<tr class="header">
<th>ID</th>
<th>Name</th>
<th>Description</th>
<th>Measurement</th>
<th>Coding</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>M1</td>
<td><code>M1_Wildcard</code></td>
<td>Record policy announcements that do not fit anywhere else</td>
<td>Free text notes field</td>
<td>Note unusual or interesting interventions that are worth flagging</td>
</tr>
</tbody>
</table>
<p>Since we want to make relations between actions as predictors and number of cases of covid19 as responses, we now need to join these two data sets, which is something that we often need to do in real life and have not done yet in this course. To join the two datasets, we will use the R function <code>merge()</code>. When we are joining datasets, we need to specify which columns are the same in the two tables, which here will be <code>CountryName</code>, <code>CountryCode</code> and <code>Date</code>. However, if you look at the data above, you will notice that we have a few problems to solve:</p>
<ol style="list-style-type: decimal">
<li><p>The date format is different between the two tables.</p></li>
<li><p>The datasets include more information than we want.</p></li>
<li><p>The column names for variables that are the same (country and date) are different.</p></li>
</ol>
<p>We will now solve each of these problems.</p>
</div>
<div id="formatting-dates" class="section level4">
<h4>Formatting dates</h4>
<p>Let’s start by solving problem 1: standardizing dates. We know R can store vectors of numbers, and vectors of characters, but dates are something different: they are neither simple numbers or characters strictly. Luckily, R also has a type of variable for dates, and with the function <code>as.Date()</code> we can transform a character string to a date.</p>
<p>Let’s do it for the <code>country_covid</code> table first. Let’s have a look before the transformation:</p>
<pre class="r"><code>head(country_covid)</code></pre>
<pre><code>##   iso_code location       date total_cases new_cases total_deaths new_deaths
## 1      ABW    Aruba 2020-03-13           2         2            0          0
## 2      ABW    Aruba 2020-03-20           4         2            0          0
## 3      ABW    Aruba 2020-03-24          12         8            0          0
## 4      ABW    Aruba 2020-03-25          17         5            0          0
## 5      ABW    Aruba 2020-03-26          19         2            0          0
## 6      ABW    Aruba 2020-03-27          28         9            0          0
##   total_cases_per_million new_cases_per_million total_deaths_per_million
## 1                  18.733                18.733                        0
## 2                  37.465                18.733                        0
## 3                 112.395                74.930                        0
## 4                 159.227                46.831                        0
## 5                 177.959                18.733                        0
## 6                 262.256                84.296                        0
##   new_deaths_per_million total_tests new_tests total_tests_per_thousand
## 1                      0          NA        NA                       NA
## 2                      0          NA        NA                       NA
## 3                      0          NA        NA                       NA
## 4                      0          NA        NA                       NA
## 5                      0          NA        NA                       NA
## 6                      0          NA        NA                       NA
##   new_tests_per_thousand new_tests_smoothed new_tests_smoothed_per_thousand
## 1                     NA                 NA                              NA
## 2                     NA                 NA                              NA
## 3                     NA                 NA                              NA
## 4                     NA                 NA                              NA
## 5                     NA                 NA                              NA
## 6                     NA                 NA                              NA
##   tests_units stringency_index population population_density median_age
## 1                         0.00     106766              584.8       41.2
## 2                        30.56     106766              584.8       41.2
## 3                        41.67     106766              584.8       41.2
## 4                        41.67     106766              584.8       41.2
## 5                        41.67     106766              584.8       41.2
## 6                        41.67     106766              584.8       41.2
##   aged_65_older aged_70_older gdp_per_capita extreme_poverty cvd_death_rate
## 1        13.085         7.452       35973.78              NA             NA
## 2        13.085         7.452       35973.78              NA             NA
## 3        13.085         7.452       35973.78              NA             NA
## 4        13.085         7.452       35973.78              NA             NA
## 5        13.085         7.452       35973.78              NA             NA
## 6        13.085         7.452       35973.78              NA             NA
##   diabetes_prevalence female_smokers male_smokers handwashing_facilities
## 1               11.62             NA           NA                     NA
## 2               11.62             NA           NA                     NA
## 3               11.62             NA           NA                     NA
## 4               11.62             NA           NA                     NA
## 5               11.62             NA           NA                     NA
## 6               11.62             NA           NA                     NA
##   hospital_beds_per_100k
## 1                     NA
## 2                     NA
## 3                     NA
## 4                     NA
## 5                     NA
## 6                     NA</code></pre>
<p>Date here is stored as a character in the format <strong>Year-Month-Day</strong>, so we will tell R that this is the format and it will figure the date out automatically. In the R syntax, we will indicate this format as <strong>%Y-%m-%d</strong></p>
<pre class="r"><code>country_covid$date &lt;- as.Date(country_covid$date, format=&#39;%Y-%m-%d&#39;)</code></pre>
<p>Let’s look again. Now the type of the column <strong>date</strong> is<code>date</code> and not <code>character</code> anymore.</p>
<pre class="r"><code>head(country_covid)</code></pre>
<pre><code>##   iso_code location       date total_cases new_cases total_deaths new_deaths
## 1      ABW    Aruba 2020-03-13           2         2            0          0
## 2      ABW    Aruba 2020-03-20           4         2            0          0
## 3      ABW    Aruba 2020-03-24          12         8            0          0
## 4      ABW    Aruba 2020-03-25          17         5            0          0
## 5      ABW    Aruba 2020-03-26          19         2            0          0
## 6      ABW    Aruba 2020-03-27          28         9            0          0
##   total_cases_per_million new_cases_per_million total_deaths_per_million
## 1                  18.733                18.733                        0
## 2                  37.465                18.733                        0
## 3                 112.395                74.930                        0
## 4                 159.227                46.831                        0
## 5                 177.959                18.733                        0
## 6                 262.256                84.296                        0
##   new_deaths_per_million total_tests new_tests total_tests_per_thousand
## 1                      0          NA        NA                       NA
## 2                      0          NA        NA                       NA
## 3                      0          NA        NA                       NA
## 4                      0          NA        NA                       NA
## 5                      0          NA        NA                       NA
## 6                      0          NA        NA                       NA
##   new_tests_per_thousand new_tests_smoothed new_tests_smoothed_per_thousand
## 1                     NA                 NA                              NA
## 2                     NA                 NA                              NA
## 3                     NA                 NA                              NA
## 4                     NA                 NA                              NA
## 5                     NA                 NA                              NA
## 6                     NA                 NA                              NA
##   tests_units stringency_index population population_density median_age
## 1                         0.00     106766              584.8       41.2
## 2                        30.56     106766              584.8       41.2
## 3                        41.67     106766              584.8       41.2
## 4                        41.67     106766              584.8       41.2
## 5                        41.67     106766              584.8       41.2
## 6                        41.67     106766              584.8       41.2
##   aged_65_older aged_70_older gdp_per_capita extreme_poverty cvd_death_rate
## 1        13.085         7.452       35973.78              NA             NA
## 2        13.085         7.452       35973.78              NA             NA
## 3        13.085         7.452       35973.78              NA             NA
## 4        13.085         7.452       35973.78              NA             NA
## 5        13.085         7.452       35973.78              NA             NA
## 6        13.085         7.452       35973.78              NA             NA
##   diabetes_prevalence female_smokers male_smokers handwashing_facilities
## 1               11.62             NA           NA                     NA
## 2               11.62             NA           NA                     NA
## 3               11.62             NA           NA                     NA
## 4               11.62             NA           NA                     NA
## 5               11.62             NA           NA                     NA
## 6               11.62             NA           NA                     NA
##   hospital_beds_per_100k
## 1                     NA
## 2                     NA
## 3                     NA
## 4                     NA
## 5                     NA
## 6                     NA</code></pre>
<p>Let’s do the same to the second table. This time, the format is <strong>YearMonthDay</strong>, without a separator. Because of that, R read it as if it were integer numbers, which is wrong, so we need first to convert them to character and then to date:</p>
<pre class="r"><code>country_response$Date &lt;- as.character(country_response$Date)
country_response$Date &lt;- as.Date(country_response$Date, format=&#39;%Y%m%d&#39;)</code></pre>
<p>Now let’s look again:</p>
<pre class="r"><code>head(country_response)</code></pre>
<pre><code>##   CountryName CountryCode       Date C1_School.closing C1_Flag
## 1       Aruba         ABW 2020-01-01                 0      NA
## 2       Aruba         ABW 2020-01-02                 0      NA
## 3       Aruba         ABW 2020-01-03                 0      NA
## 4       Aruba         ABW 2020-01-04                 0      NA
## 5       Aruba         ABW 2020-01-05                 0      NA
## 6       Aruba         ABW 2020-01-06                 0      NA
##   C2_Workplace.closing C2_Flag C3_Cancel.public.events C3_Flag
## 1                    0      NA                       0      NA
## 2                    0      NA                       0      NA
## 3                    0      NA                       0      NA
## 4                    0      NA                       0      NA
## 5                    0      NA                       0      NA
## 6                    0      NA                       0      NA
##   C4_Restrictions.on.gatherings C4_Flag C5_Close.public.transport C5_Flag
## 1                             0      NA                         0      NA
## 2                             0      NA                         0      NA
## 3                             0      NA                         0      NA
## 4                             0      NA                         0      NA
## 5                             0      NA                         0      NA
## 6                             0      NA                         0      NA
##   C6_Stay.at.home.requirements C6_Flag C7_Restrictions.on.internal.movement
## 1                            0      NA                                    0
## 2                            0      NA                                    0
## 3                            0      NA                                    0
## 4                            0      NA                                    0
## 5                            0      NA                                    0
## 6                            0      NA                                    0
##   C7_Flag C8_International.travel.controls E1_Income.support E1_Flag
## 1      NA                                0                 0      NA
## 2      NA                                0                 0      NA
## 3      NA                                0                 0      NA
## 4      NA                                0                 0      NA
## 5      NA                                0                 0      NA
## 6      NA                                0                 0      NA
##   E2_Debt.contract.relief E3_Fiscal.measures E4_International.support
## 1                       0                  0                        0
## 2                       0                  0                        0
## 3                       0                  0                        0
## 4                       0                  0                        0
## 5                       0                  0                        0
## 6                       0                  0                        0
##   H1_Public.information.campaigns H1_Flag H2_Testing.policy H3_Contact.tracing
## 1                               0      NA                 0                  0
## 2                               0      NA                 0                  0
## 3                               0      NA                 0                  0
## 4                               0      NA                 0                  0
## 5                               0      NA                 0                  0
## 6                               0      NA                 0                  0
##   H4_Emergency.investment.in.healthcare H5_Investment.in.vaccines M1_Wildcard
## 1                                     0                         0          NA
## 2                                     0                         0          NA
## 3                                     0                         0          NA
## 4                                     0                         0          NA
## 5                                     0                         0          NA
## 6                                     0                         0          NA
##   ConfirmedCases ConfirmedDeaths StringencyIndex StringencyIndexForDisplay
## 1             NA              NA               0                         0
## 2             NA              NA               0                         0
## 3             NA              NA               0                         0
## 4             NA              NA               0                         0
## 5             NA              NA               0                         0
## 6             NA              NA               0                         0
##   StringencyLegacyIndex StringencyLegacyIndexForDisplay GovernmentResponseIndex
## 1                     0                               0                       0
## 2                     0                               0                       0
## 3                     0                               0                       0
## 4                     0                               0                       0
## 5                     0                               0                       0
## 6                     0                               0                       0
##   GovernmentResponseIndexForDisplay ContainmentHealthIndex
## 1                                 0                      0
## 2                                 0                      0
## 3                                 0                      0
## 4                                 0                      0
## 5                                 0                      0
## 6                                 0                      0
##   ContainmentHealthIndexForDisplay EconomicSupportIndex
## 1                                0                    0
## 2                                0                    0
## 3                                0                    0
## 4                                0                    0
## 5                                0                    0
## 6                                0                    0
##   EconomicSupportIndexForDisplay
## 1                              0
## 2                              0
## 3                              0
## 4                              0
## 5                              0
## 6                              0</code></pre>
</div>
<div id="summarizing-important-data" class="section level4">
<h4>Summarizing important data</h4>
<p>Since covid19 has an incubation time of up to 2 weeks, it is reasonable to assume that the current number of daily cases is a result of interventions that have been done in the last few weeks, so instead of using all data on all interventions ever done, we will record the most common intervention on the last 30 days. So, for example, if schools have been closed for most days during the last 4 weeks, we will record a country state as schools closed.</p>
<p>To do that, we will start by filtering the <code>covid_response</code> table, which holds our interventions, to include only records in the last 30 days. Since we transformed the <code>Date</code> column in an actual date already, R will allow us to do math. To get the current date (2020-05-26), we use the function <code>Sys.Date()</code>:</p>
<pre class="r"><code>Sys.Date()</code></pre>
<pre><code>## [1] &quot;2020-05-26&quot;</code></pre>
<p>So, for example, the difference between today and January first is:</p>
<pre class="r"><code>Sys.Date() - as.Date(&#39;2020-01-01&#39;)</code></pre>
<pre><code>## Time difference of 146 days</code></pre>
<p>We an use that to find rows which for which the date is less or equal to 30 days before today. Let’s do that for the first 10 records:</p>
<pre class="r"><code>Sys.Date() - country_response$Date[1:10] &lt;= 30</code></pre>
<pre><code>##  [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE</code></pre>
<p>Now let’s use this to filter the data.frame:</p>
<pre class="r"><code>country_response &lt;- country_response[as.numeric(Sys.Date() - country_response$Date) &lt;=  30, ]
head(country_response)</code></pre>
<pre><code>##     CountryName CountryCode       Date C1_School.closing C1_Flag
## 117       Aruba         ABW 2020-04-26                 3       1
## 118       Aruba         ABW 2020-04-27                 3       1
## 119       Aruba         ABW 2020-04-28                 3       1
## 120       Aruba         ABW 2020-04-29                 3       1
## 121       Aruba         ABW 2020-04-30                 3       1
## 122       Aruba         ABW 2020-05-01                 3       1
##     C2_Workplace.closing C2_Flag C3_Cancel.public.events C3_Flag
## 117                    3       1                       2       1
## 118                    3       1                       2       1
## 119                    3       1                       2       1
## 120                    3       1                       2       1
## 121                    3       1                       2       1
## 122                    3       1                       2       1
##     C4_Restrictions.on.gatherings C4_Flag C5_Close.public.transport C5_Flag
## 117                             4       1                         0      NA
## 118                             4       1                         0      NA
## 119                             4       1                         0      NA
## 120                             4       1                         0      NA
## 121                             4       1                         0      NA
## 122                             4       1                         0      NA
##     C6_Stay.at.home.requirements C6_Flag C7_Restrictions.on.internal.movement
## 117                            2       1                                    2
## 118                            2       1                                    2
## 119                            2       1                                    2
## 120                            2       1                                    2
## 121                            2       1                                    2
## 122                            2       1                                    2
##     C7_Flag C8_International.travel.controls E1_Income.support E1_Flag
## 117       1                                3                 2       1
## 118       1                                3                 2       1
## 119       1                                3                 2       1
## 120       1                                3                 2       1
## 121       1                                3                 2       1
## 122       1                                3                 2       1
##     E2_Debt.contract.relief E3_Fiscal.measures E4_International.support
## 117                       0                  0                        0
## 118                       0                  0                        0
## 119                       0                  0                        0
## 120                       0                  0                        0
## 121                       0                  0                        0
## 122                       0                  0                        0
##     H1_Public.information.campaigns H1_Flag H2_Testing.policy
## 117                               2       1                 1
## 118                               2       1                 1
## 119                               2       1                 1
## 120                               2       1                 1
## 121                               2       1                 1
## 122                               2       1                 1
##     H3_Contact.tracing H4_Emergency.investment.in.healthcare
## 117                  1                                     0
## 118                  1                                     0
## 119                  1                                     0
## 120                  1                                     0
## 121                  1                                     0
## 122                  1                                     0
##     H5_Investment.in.vaccines M1_Wildcard ConfirmedCases ConfirmedDeaths
## 117                         0          NA            100               2
## 118                         0          NA            100               2
## 119                         0          NA            100               2
## 120                         0          NA            100               2
## 121                         0          NA            100               2
## 122                         0          NA            100               2
##     StringencyIndex StringencyIndexForDisplay StringencyLegacyIndex
## 117           82.41                     82.41                    80
## 118           82.41                     82.41                    80
## 119           82.41                     82.41                    80
## 120           82.41                     82.41                    80
## 121           82.41                     82.41                    80
## 122           82.41                     82.41                    80
##     StringencyLegacyIndexForDisplay GovernmentResponseIndex
## 117                              80                   71.15
## 118                              80                   71.15
## 119                              80                   71.15
## 120                              80                   71.15
## 121                              80                   71.15
## 122                              80                   71.15
##     GovernmentResponseIndexForDisplay ContainmentHealthIndex
## 117                             71.15                     75
## 118                             71.15                     75
## 119                             71.15                     75
## 120                             71.15                     75
## 121                             71.15                     75
## 122                             71.15                     75
##     ContainmentHealthIndexForDisplay EconomicSupportIndex
## 117                               75                   50
## 118                               75                   50
## 119                               75                   50
## 120                               75                   50
## 121                               75                   50
## 122                               75                   50
##     EconomicSupportIndexForDisplay
## 117                             50
## 118                             50
## 119                             50
## 120                             50
## 121                             50
## 122                             50</code></pre>
<p>Now that all dates correspond to the last 30 days, we can aggregate all columns except name and date by country code. Since R does not have a bultin function to calculate the mode (i. e. the most frequent) of a sequence of numbers, we will create a new function to do that. This function will use <code>table()</code> to calculate the frequency of each category and <code>which()</code> to index the category that has the same frequency as the maximum frequency. If there is a tie, we will pick the intervention that was in place first. If all input values are NA, we return NA</p>
<pre class="r"><code>get_mode &lt;- function(x){
  if (all(is.na(x))) {return(NA)}
  
  freqs &lt;- table(x)
  most_common &lt;- names(freqs)[which(freqs == max(freqs))]
  if (length(most_common) == 1) 
  {
    return(most_common)
    }
  else
  {
    first_occurrence &lt;- match(most_common, x)
    most_common &lt;- most_common[which(first_occurrence == min(first_occurrence))]
    return(most_common)
    }
}</code></pre>
<p>Let’s check if the function works as expected:</p>
<pre class="r"><code>get_mode(c(0,0,1,1))</code></pre>
<pre><code>## [1] &quot;0&quot;</code></pre>
<pre class="r"><code>get_mode(c(1,1,0,0))</code></pre>
<pre><code>## [1] &quot;1&quot;</code></pre>
<pre class="r"><code>get_mode(c(&#39;A&#39;,&#39;A&#39;,&#39;C&#39;,&#39;B&#39;,&#39;E&#39;))</code></pre>
<pre><code>## [1] &quot;A&quot;</code></pre>
<pre class="r"><code>get_mode(c(0,0,1,1,NA,NA,NA))</code></pre>
<pre><code>## [1] &quot;0&quot;</code></pre>
<pre class="r"><code>get_mode(c(NA,NA,NA))</code></pre>
<pre><code>## [1] NA</code></pre>
<p>It does! Let’s apply it to our data.frame with aggregate</p>
<pre class="r"><code>only_responses &lt;- country_response[4:length(country_response)]

common_responses &lt;- aggregate(only_responses, by = country_response[&#39;CountryCode&#39;], FUN = function(x) get_mode(x))
head(common_responses)</code></pre>
<pre><code>##   CountryCode C1_School.closing C1_Flag C2_Workplace.closing C2_Flag
## 1         ABW                 3       1                    2       1
## 2         AFG                 3       1                    3       0
## 3         AGO                 3       1                    2       1
## 4         ALB                 3       1                    2       1
## 5         AND                 3       1                    2       1
## 6         ARE                 3       1                    2       1
##   C3_Cancel.public.events C3_Flag C4_Restrictions.on.gatherings C4_Flag
## 1                       2       1                             4       1
## 2                       2       1                             4       1
## 3                       2       1                             3       1
## 4                       2       1                             4       1
## 5                       1       1                             0    &lt;NA&gt;
## 6                       2       1                             4       1
##   C5_Close.public.transport C5_Flag C6_Stay.at.home.requirements C6_Flag
## 1                         0    &lt;NA&gt;                            2       1
## 2                         2       0                            2       0
## 3                         1       1                            2       1
## 4                         2       0                            2       1
## 5                         1       1                            1       1
## 6                         1       1                            2       1
##   C7_Restrictions.on.internal.movement C7_Flag C8_International.travel.controls
## 1                                    2       1                                3
## 2                                    2       0                                1
## 3                                    2       0                                4
## 4                                    2       1                                4
## 5                                    0    &lt;NA&gt;                                3
## 6                                    1       1                                4
##   E1_Income.support E1_Flag E2_Debt.contract.relief E3_Fiscal.measures
## 1                 2       1                       0                  0
## 2                 0    &lt;NA&gt;                       0                  0
## 3                 0    &lt;NA&gt;                       2                  0
## 4                 2       0                       1                  0
## 5                 2       1                       0                  0
## 6                 0    &lt;NA&gt;                       2                  0
##   E4_International.support H1_Public.information.campaigns H1_Flag
## 1                        0                               2       1
## 2                        0                               2       1
## 3                        0                               1       1
## 4                        0                               2       1
## 5                        0                               2       1
## 6                        0                               2       1
##   H2_Testing.policy H3_Contact.tracing H4_Emergency.investment.in.healthcare
## 1                 1                  1                                     0
## 2                 1                  1                                     0
## 3                 2                  0                                     0
## 4                 2                  1                                     0
## 5                 3                  1                                     0
## 6                 3                  2                                     0
##   H5_Investment.in.vaccines M1_Wildcard ConfirmedCases ConfirmedDeaths
## 1                         0          NA            101               3
## 2                         0          NA           6402              57
## 3                         0          NA             48               2
## 4                         0          NA            712              31
## 5                         0          NA            761              51
## 6                         0          NA           9813              64
##   StringencyIndex StringencyIndexForDisplay StringencyLegacyIndex
## 1            78.7                      78.7                 76.43
## 2            78.7                      78.7                 75.48
## 3            78.7                      78.7                 80.48
## 4           89.81                     89.81                 88.81
## 5           52.78                        50                 74.05
## 6           81.48                     81.48                 85.24
##   StringencyLegacyIndexForDisplay GovernmentResponseIndex
## 1                           76.43                   68.59
## 2                           75.48                    60.9
## 3                           80.48                   67.31
## 4                           88.81                   80.77
## 5                           71.19                   55.77
## 6                           85.24                   79.49
##   GovernmentResponseIndexForDisplay ContainmentHealthIndex
## 1                             68.59                  71.97
## 2                              60.9                  71.97
## 3                             67.31                  70.45
## 4                             80.77                  84.09
## 5                             61.54                  56.82
## 6                             79.49                  84.85
##   ContainmentHealthIndexForDisplay EconomicSupportIndex
## 1                            71.97                   50
## 2                            71.97                    0
## 3                            70.45                   50
## 4                            84.09                 62.5
## 5                            54.55                   50
## 6                            84.85                   50
##   EconomicSupportIndexForDisplay
## 1                             50
## 2                              0
## 3                             50
## 4                           62.5
## 5                            100
## 6                             50</code></pre>
<p>Also, the number of new cases in a particular day depends on factors such as how many people were working on tests (fewer on weekends, for example), so instead of relying on a single day, let’s average the daily cases in the last 5 days as our response variable. We will use the same trick as above, but in the <code>country_covid</code> table. We will also remove columns about total cases, since these don’t make sense averaging.</p>
<pre class="r"><code>columns_total &lt;- c(&#39;total_cases&#39;, &#39;total_deaths&#39;, &#39;total_cases_per_million&#39;, &#39;total_deaths_per_million&#39;, &#39;total_tests&#39;, &#39;total_tests_per_thousand&#39;)
idx = match(columns_total, colnames(country_covid))

country_covid_5 &lt;- country_covid[Sys.Date() - country_covid$date &lt; 5, -idx ]
only_covid &lt;- country_covid_5[4:length(country_covid_5)]

average_covid &lt;- aggregate(only_covid, by = country_covid_5[&#39;iso_code&#39;], FUN = mean, na.rm = T)
head(average_covid)</code></pre>
<pre><code>##   iso_code new_cases new_deaths new_cases_per_million new_deaths_per_million
## 1      ABW       0.0        0.0                0.0000                 0.0000
## 2      AFG     605.6        6.4               15.5568                 0.1644
## 3      AGO       3.4        0.2                0.1036                 0.0060
## 4      AIA       0.0        0.0                0.0000                 0.0000
## 5      ALB       8.0        0.2                2.7798                 0.0694
## 6      AND       0.2        0.0                2.5884                 0.0000
##   new_tests new_tests_per_thousand new_tests_smoothed
## 1       NaN                    NaN                NaN
## 2       NaN                    NaN                NaN
## 3       NaN                    NaN                NaN
## 4       NaN                    NaN                NaN
## 5       NaN                    NaN                NaN
## 6       NaN                    NaN                NaN
##   new_tests_smoothed_per_thousand tests_units stringency_index population
## 1                             NaN          NA              NaN     106766
## 2                             NaN          NA              NaN   38928341
## 3                             NaN          NA            81.48   32866268
## 4                             NaN          NA              NaN      15002
## 5                             NaN          NA            84.26    2877800
## 6                             NaN          NA              NaN      77265
##   population_density median_age aged_65_older aged_70_older gdp_per_capita
## 1            584.800       41.2        13.085         7.452      35973.781
## 2             54.422       18.6         2.581         1.337       1803.987
## 3             23.890       16.8         2.405         1.362       5819.495
## 4                NaN        NaN           NaN           NaN            NaN
## 5            104.871       38.0        13.188         8.643      11803.431
## 6            163.755        NaN           NaN           NaN            NaN
##   extreme_poverty cvd_death_rate diabetes_prevalence female_smokers
## 1             NaN            NaN               11.62            NaN
## 2             NaN        597.029                9.59            NaN
## 3             NaN        276.045                3.94            NaN
## 4             NaN            NaN                 NaN            NaN
## 5             1.1        304.195               10.08            7.1
## 6             NaN        109.135                7.97           29.0
##   male_smokers handwashing_facilities hospital_beds_per_100k
## 1          NaN                    NaN                    NaN
## 2          NaN                 37.746                   0.50
## 3          NaN                 26.664                    NaN
## 4          NaN                    NaN                    NaN
## 5         51.2                    NaN                   2.89
## 6         37.8                    NaN                    NaN</code></pre>
<p>The aggregate function above returns a warning several times: <code>argument is not numeric or logical: returning NA</code>. This warning is shown every time <code>aggregate</code> is trying to take the average of values that are not numbers. This is the case of the column <code>test_units</code>, which is a character. It has values such as <strong>“tests performed”</strong>. In this case, taking the mean does not make sense and the whole column is filled with NAs. Since we will not use it here, we will just ignore the warning.</p>
<p>Now we will record total cases, total deaths, etc for the last day in our dataset. To do that, we will first filter the columns in the dataset, then sort it by date and then use aggregate to get only the first record in each data</p>
<pre class="r"><code>total_covid &lt;- country_covid[,c(&#39;iso_code&#39;,&#39;date&#39;,columns_total)]
head(total_covid)</code></pre>
<pre><code>##   iso_code       date total_cases total_deaths total_cases_per_million
## 1      ABW 2020-03-13           2            0                  18.733
## 2      ABW 2020-03-20           4            0                  37.465
## 3      ABW 2020-03-24          12            0                 112.395
## 4      ABW 2020-03-25          17            0                 159.227
## 5      ABW 2020-03-26          19            0                 177.959
## 6      ABW 2020-03-27          28            0                 262.256
##   total_deaths_per_million total_tests total_tests_per_thousand
## 1                        0          NA                       NA
## 2                        0          NA                       NA
## 3                        0          NA                       NA
## 4                        0          NA                       NA
## 5                        0          NA                       NA
## 6                        0          NA                       NA</code></pre>
<p>Now we can sort by date. Even though there is a function named <code>sort()</code>, it works to sort vectors, not data.frames. To sort a data.frame, we have to use the function <code>order()</code> to figure out the order in which one or more columns should be sorted, and then use this to index the whole data.frame by row. We will also use the function with so we can type column names:</p>
<p>So to sort this data.frame in inverse order, first by country and then by date:</p>
<pre class="r"><code>total_covid &lt;- with(total_covid, total_covid[order(iso_code,date,decreasing = T),])</code></pre>
<p>Now we can use <code>aggregate()</code> to get just the first row for each country. We will exclude columns 1 and 2 (country and date)</p>
<pre class="r"><code>get_first &lt;- function(x)x[1]
total_covid &lt;- aggregate(total_covid[,-c(1,2)],by=total_covid[&#39;iso_code&#39;],FUN = get_first)</code></pre>
<p>Lastly, history is probably important, so we also want to record the number of daily cases 15 days ago, before our intervention window starts. We will average the number of daily cases between 30-35 days ago. We will also rename the column so this is not confused with the recent new cases.</p>
<pre class="r"><code>country_covid_30 &lt;- country_covid[Sys.Date() - country_covid$date &lt; 35 &amp; Sys.Date() - country_covid$date &gt;= 30,]

past_covid &lt;- aggregate(country_covid_30[&#39;new_cases&#39;], 
                          by = country_covid_30[&#39;iso_code&#39;], 
                          FUN = mean, 
                          na.rm = T)
colnames(past_covid)[2] &lt;- &#39;past_cases&#39; 

head(past_covid)</code></pre>
<pre><code>##   iso_code past_cases
## 1      ABW        0.6
## 2      AFG       86.4
## 3      AGO        0.2
## 4      AIA        0.0
## 5      ALB       25.6
## 6      AND        3.2</code></pre>
</div>
</div>
<div id="joining-datasets" class="section level3">
<h3>Joining datasets</h3>
<p>Now that we have cleaned and summarized the data, let’s join the datasets. Joining <code>average_covid</code> and <code>past_covid</code> is easy because the column for country code has the same name in both. We use the function <code>merge()</code> and provide the two data.frames as arguments:</p>
<pre class="r"><code>joint_covid &lt;- merge(past_covid, average_covid)</code></pre>
<p>We will do that with total number of cases now.</p>
<pre class="r"><code>joint_covid &lt;- merge(joint_covid, total_covid)</code></pre>
<p>To join the next table, we need to say which column in each one corresponds to country code, since they have different column names. We do that by using the arguments <code>by.x</code> to provide column names for the first table and <code>by.y</code> for the second table. By default, <code>merge</code> will drop countries that are not present in the two tables. If this is not the intended behavior, check the function help for the argument <code>all</code>.</p>
<pre class="r"><code>joint_covid &lt;- merge(joint_covid, common_responses, by.x = &#39;iso_code&#39;, by.y= &#39;CountryCode&#39;, all = FALSE)</code></pre>
<p>Now let’s have a look at the data.frame</p>
<pre class="r"><code>head(joint_covid)</code></pre>
<pre><code>##   iso_code past_cases new_cases new_deaths new_cases_per_million
## 1      ABW        0.6       0.0        0.0                0.0000
## 2      AFG       86.4     605.6        6.4               15.5568
## 3      AGO        0.2       3.4        0.2                0.1036
## 4      ALB       25.6       8.0        0.2                2.7798
## 5      AND        3.2       0.2        0.0                2.5884
## 6      ARE      509.6     860.6        3.0               87.0136
##   new_deaths_per_million new_tests new_tests_per_thousand new_tests_smoothed
## 1                 0.0000       NaN                    NaN                NaN
## 2                 0.1644       NaN                    NaN                NaN
## 3                 0.0060       NaN                    NaN                NaN
## 4                 0.0694       NaN                    NaN                NaN
## 5                 0.0000       NaN                    NaN                NaN
## 6                 0.3030       NaN                    NaN                NaN
##   new_tests_smoothed_per_thousand tests_units stringency_index population
## 1                             NaN          NA              NaN     106766
## 2                             NaN          NA              NaN   38928341
## 3                             NaN          NA            81.48   32866268
## 4                             NaN          NA            84.26    2877800
## 5                             NaN          NA              NaN      77265
## 6                             NaN          NA              NaN    9890400
##   population_density median_age aged_65_older aged_70_older gdp_per_capita
## 1            584.800       41.2        13.085         7.452      35973.781
## 2             54.422       18.6         2.581         1.337       1803.987
## 3             23.890       16.8         2.405         1.362       5819.495
## 4            104.871       38.0        13.188         8.643      11803.431
## 5            163.755        NaN           NaN           NaN            NaN
## 6            112.442       34.0         1.144         0.526      67293.483
##   extreme_poverty cvd_death_rate diabetes_prevalence female_smokers
## 1             NaN            NaN               11.62            NaN
## 2             NaN        597.029                9.59            NaN
## 3             NaN        276.045                3.94            NaN
## 4             1.1        304.195               10.08            7.1
## 5             NaN        109.135                7.97           29.0
## 6             NaN        317.840               17.26            1.2
##   male_smokers handwashing_facilities hospital_beds_per_100k total_cases
## 1          NaN                    NaN                    NaN         101
## 2          NaN                 37.746                   0.50       11173
## 3          NaN                 26.664                    NaN          69
## 4         51.2                    NaN                   2.89        1004
## 5         37.8                    NaN                    NaN         763
## 6         37.4                    NaN                   1.20       30307
##   total_deaths total_cases_per_million total_deaths_per_million total_tests
## 1            3                 945.994                   28.099          NA
## 2          219                 287.015                    5.626          NA
## 3            4                   2.099                    0.122          NA
## 4           32                 348.878                   11.120          NA
## 5           51                9875.105                  660.066          NA
## 6          248                3064.285                   25.075          NA
##   total_tests_per_thousand C1_School.closing C1_Flag C2_Workplace.closing
## 1                       NA                 3       1                    2
## 2                       NA                 3       1                    3
## 3                       NA                 3       1                    2
## 4                       NA                 3       1                    2
## 5                       NA                 3       1                    2
## 6                       NA                 3       1                    2
##   C2_Flag C3_Cancel.public.events C3_Flag C4_Restrictions.on.gatherings C4_Flag
## 1       1                       2       1                             4       1
## 2       0                       2       1                             4       1
## 3       1                       2       1                             3       1
## 4       1                       2       1                             4       1
## 5       1                       1       1                             0    &lt;NA&gt;
## 6       1                       2       1                             4       1
##   C5_Close.public.transport C5_Flag C6_Stay.at.home.requirements C6_Flag
## 1                         0    &lt;NA&gt;                            2       1
## 2                         2       0                            2       0
## 3                         1       1                            2       1
## 4                         2       0                            2       1
## 5                         1       1                            1       1
## 6                         1       1                            2       1
##   C7_Restrictions.on.internal.movement C7_Flag C8_International.travel.controls
## 1                                    2       1                                3
## 2                                    2       0                                1
## 3                                    2       0                                4
## 4                                    2       1                                4
## 5                                    0    &lt;NA&gt;                                3
## 6                                    1       1                                4
##   E1_Income.support E1_Flag E2_Debt.contract.relief E3_Fiscal.measures
## 1                 2       1                       0                  0
## 2                 0    &lt;NA&gt;                       0                  0
## 3                 0    &lt;NA&gt;                       2                  0
## 4                 2       0                       1                  0
## 5                 2       1                       0                  0
## 6                 0    &lt;NA&gt;                       2                  0
##   E4_International.support H1_Public.information.campaigns H1_Flag
## 1                        0                               2       1
## 2                        0                               2       1
## 3                        0                               1       1
## 4                        0                               2       1
## 5                        0                               2       1
## 6                        0                               2       1
##   H2_Testing.policy H3_Contact.tracing H4_Emergency.investment.in.healthcare
## 1                 1                  1                                     0
## 2                 1                  1                                     0
## 3                 2                  0                                     0
## 4                 2                  1                                     0
## 5                 3                  1                                     0
## 6                 3                  2                                     0
##   H5_Investment.in.vaccines M1_Wildcard ConfirmedCases ConfirmedDeaths
## 1                         0          NA            101               3
## 2                         0          NA           6402              57
## 3                         0          NA             48               2
## 4                         0          NA            712              31
## 5                         0          NA            761              51
## 6                         0          NA           9813              64
##   StringencyIndex StringencyIndexForDisplay StringencyLegacyIndex
## 1            78.7                      78.7                 76.43
## 2            78.7                      78.7                 75.48
## 3            78.7                      78.7                 80.48
## 4           89.81                     89.81                 88.81
## 5           52.78                        50                 74.05
## 6           81.48                     81.48                 85.24
##   StringencyLegacyIndexForDisplay GovernmentResponseIndex
## 1                           76.43                   68.59
## 2                           75.48                    60.9
## 3                           80.48                   67.31
## 4                           88.81                   80.77
## 5                           71.19                   55.77
## 6                           85.24                   79.49
##   GovernmentResponseIndexForDisplay ContainmentHealthIndex
## 1                             68.59                  71.97
## 2                              60.9                  71.97
## 3                             67.31                  70.45
## 4                             80.77                  84.09
## 5                             61.54                  56.82
## 6                             79.49                  84.85
##   ContainmentHealthIndexForDisplay EconomicSupportIndex
## 1                            71.97                   50
## 2                            71.97                    0
## 3                            70.45                   50
## 4                            84.09                 62.5
## 5                            54.55                   50
## 6                            84.85                   50
##   EconomicSupportIndexForDisplay
## 1                             50
## 2                              0
## 3                             50
## 4                           62.5
## 5                            100
## 6                             50</code></pre>
</div>
<div id="adding-country-names-and-region-data" class="section level3">
<h3>Adding country names and region data</h3>
<p>You might have noticed that in the process of summarizing and merging we only used country codes and lost country names. The reason is that these three-letter codes are standardized across datasets (you can read more on <a href="https://en.wikipedia.org/wiki/List_of_ISO_3166_country_codes">Wikipedia</a>), while country names may vary. For example one of our tables uses <em>Kyrgyz Republic</em> and another uses <em>Kyrgyzstan</em> for the same country, but both use the same 3-letter code: <em>KGZ</em>. To finalize the preparation of our dataset we will add back country names and also include information about the continent in which these countries are.</p>
<p>The R package <code>rworldmap</code> can be used to retrieve this data. If you do not have it installed, you can do it by using <code>install.packages('rworldmap')</code>. One way to access functions in a package is to to lead them first with <code>library(package_name)</code>. Another way that we have not seem before is to call the function without loading the package (but it has to be installed), by using <code>package_name::function_name</code>. This is convenient to make it clear from which package a function comes from, so you remember later when read your code, and also when we just want to use one function, not the whole package functionality. Since we will not plot maps today and we just want access to one data table, we will call the function directly without loading the package. The function <code>getMap()</code> in this package returns a map object that includes a data frame with country data. We would need additional R packages (namely, the package <code>sp</code>) to actually plot the map, so for now we will simply transform the map into a simple data frame with <code>as.data.frame()</code> and keep the data only.</p>
<pre class="r"><code>all_country_data &lt;- as.data.frame(rworldmap::getMap())
head(all_country_data)</code></pre>
<pre><code>##   ScaleRank LabelRank        FeatureCla           SOVEREIGNT SOV_A3 ADM0_DIF
## 1         1         1 Admin-0 countries          Afghanistan    AFG        0
## 2         1         1 Admin-0 countries               Angola    AGO        0
## 3         1         1 Admin-0 countries              Albania    ALB        0
## 4         1         1 Admin-0 countries United Arab Emirates    ARE        0
## 5         1         1 Admin-0 countries            Argentina    ARG        0
## 6         1         1 Admin-0 countries              Armenia    ARM        0
##   LEVEL              TYPE                ADMIN ADM0_A3 GEOU_DIF
## 1     2 Sovereign country          Afghanistan     AFG        0
## 2     2 Sovereign country               Angola     AGO        0
## 3     2 Sovereign country              Albania     ALB        0
## 4     2 Sovereign country United Arab Emirates     ARE        0
## 5     2 Sovereign country            Argentina     ARG        0
## 6     2 Sovereign country              Armenia     ARM        0
##                GEOUNIT GU_A3 SU_DIF              SUBUNIT SU_A3
## 1          Afghanistan   AFG      0          Afghanistan   AFG
## 2               Angola   AGO      0               Angola   AGO
## 3              Albania   ALB      0              Albania   ALB
## 4 United Arab Emirates   ARE      0 United Arab Emirates   ARE
## 5            Argentina   ARG      0            Argentina   ARG
## 6              Armenia   ARM      0              Armenia   ARM
##                   NAME ABBREV POSTAL                   NAME_FORMA TERR_
## 1          Afghanistan   Afg.     AF Islamic State of Afghanistan  &lt;NA&gt;
## 2               Angola   Ang.     AO           Republic of Angola  &lt;NA&gt;
## 3              Albania   Alb.     AL          Republic of Albania  &lt;NA&gt;
## 4 United Arab Emirates U.A.E.     AE                         &lt;NA&gt;  &lt;NA&gt;
## 5            Argentina   Arg.     AR           Argentine Republic  &lt;NA&gt;
## 6              Armenia   Arm.    ARM          Republic of Armenia  &lt;NA&gt;
##              NAME_SORT MAP_COLOR  POP_EST GDP_MD_EST FIPS_10_ ISO_A2 ISO_A3
## 1          Afghanistan         7 28400000      22270        0     AF    AFG
## 2               Angola         1 12799293     110300        0     AO    AGO
## 3              Albania         6  3639453      21810        0     AL    ALB
## 4 United Arab Emirates         3  4798491     184300        0     AE    ARE
## 5            Argentina        13 40913584     573900        0     AR    ARG
## 6              Armenia        10  2967004      18770        0     AM    ARM
##   ISO_N3 ISO3       LON       LAT ISO3.1              ADMIN.1        REGION
## 1      4  AFG  66.08669  33.85640    AFG          Afghanistan          Asia
## 2     24  AGO  17.50291 -12.29155    AGO               Angola        Africa
## 3      8  ALB  20.03243  41.14135    ALB              Albania        Europe
## 4    784  ARE  54.20671  23.86863    ARE United Arab Emirates          Asia
## 5     32  ARG -65.14954 -35.22017    ARG            Argentina South America
## 6     51  ARM  45.00029  40.21661    ARM              Armenia        Europe
##       continent                       GEO3major              GEO3
## 1       Eurasia            Asia and the Pacific        South Asia
## 2        Africa                          Africa   Southern Africa
## 3       Eurasia                          Europe    Central Europe
## 4       Eurasia                       West Asia Arabian Peninsula
## 5 South America Latin America and the Caribbean     South America
## 6       Eurasia                          Europe    Eastern Europe
##              IMAGE24             GLOCAF          Stern SRESmajor
## 1             India+ Rest of South Asia   Central Asia      ASIA
## 2    Southern Africa Sub-Sarahan Africa South+E Africa       ALM
## 3     Central Europe             Europe         Europe       REF
## 4        Middle East        Middle East      West Asia       ALM
## 5 Rest South America   Rest of South Am  South America       ALM
## 6            Russia+                FSU         Europe       REF
##                                    SRES                         GBD
## 1                      South Asia (SAS)                 Asia, South
## 2              Sub-Saharan Africa (AFR) Sub-Saharan Africa, Central
## 3      Central and Eastern Europe (EEU)             Europe, Central
## 4    Middle East and North Africa (MEA)    North Africa/Middle East
## 5 Latin America and the Caribbean (LAM)     Latin America, Southern
## 6 Newly Independent States of FSU (FSU)               Asia, Central
##   AVOIDnumeric                AVOIDname   LDC   SID  LLDC
## 1           21     Rest of Central Asia   LDC other  LLDC
## 2           24 Southern and East Africa   LDC other other
## 3           25                   Europe other other other
## 4           30              Middle East other other other
## 5           26            South America other other other
## 6           25                   Europe other other  LLDC</code></pre>
<p>The data frame above includes a lot more information than we need. We only want 3 things:
1. Country code, to match with our dataset
2. Country name
3. Region in which the country is located</p>
<p>There are several options for regions, and we will select GEO3major, which splits the world in 7 regions:</p>
<pre class="r"><code>levels(all_country_data$GEO3major)</code></pre>
<pre><code>## [1] &quot;Africa&quot;                          &quot;Asia and the Pacific&quot;           
## [3] &quot;Europe&quot;                          &quot;Latin America and the Caribbean&quot;
## [5] &quot;North America&quot;                   &quot;Polar&quot;                          
## [7] &quot;West Asia&quot;</code></pre>
<p>Let’s select these columns:</p>
<pre class="r"><code>all_country_data &lt;- all_country_data[c(&#39;ISO3&#39;,&#39;NAME&#39;,&#39;GEO3major&#39;)]
head(all_country_data)</code></pre>
<pre><code>##   ISO3                 NAME                       GEO3major
## 1  AFG          Afghanistan            Asia and the Pacific
## 2  AGO               Angola                          Africa
## 3  ALB              Albania                          Europe
## 4  ARE United Arab Emirates                       West Asia
## 5  ARG            Argentina Latin America and the Caribbean
## 6  ARM              Armenia                          Europe</code></pre>
<p>Let’s also rename the columns to something that is easier to understand.</p>
<pre class="r"><code>colnames(all_country_data) &lt;- c(&#39;iso_code&#39;,&#39;country_name&#39;,&#39;world_region&#39;)</code></pre>
<p>Since the columns with country code has the same name as in our data.frame now, we can call <code>merge()</code> without additional arguments.</p>
<pre class="r"><code>joint_covid &lt;- merge(all_country_data, joint_covid)</code></pre>
<p>This is our final dataset:</p>
<pre class="r"><code>head(joint_covid)</code></pre>
<pre><code>##   iso_code         country_name                    world_region past_cases
## 1      ABW                Aruba Latin America and the Caribbean        0.6
## 2      AFG          Afghanistan            Asia and the Pacific       86.4
## 3      AGO               Angola                          Africa        0.2
## 4      ALB              Albania                          Europe       25.6
## 5      AND              Andorra                          Europe        3.2
## 6      ARE United Arab Emirates                       West Asia      509.6
##   new_cases new_deaths new_cases_per_million new_deaths_per_million new_tests
## 1       0.0        0.0                0.0000                 0.0000       NaN
## 2     605.6        6.4               15.5568                 0.1644       NaN
## 3       3.4        0.2                0.1036                 0.0060       NaN
## 4       8.0        0.2                2.7798                 0.0694       NaN
## 5       0.2        0.0                2.5884                 0.0000       NaN
## 6     860.6        3.0               87.0136                 0.3030       NaN
##   new_tests_per_thousand new_tests_smoothed new_tests_smoothed_per_thousand
## 1                    NaN                NaN                             NaN
## 2                    NaN                NaN                             NaN
## 3                    NaN                NaN                             NaN
## 4                    NaN                NaN                             NaN
## 5                    NaN                NaN                             NaN
## 6                    NaN                NaN                             NaN
##   tests_units stringency_index population population_density median_age
## 1          NA              NaN     106766            584.800       41.2
## 2          NA              NaN   38928341             54.422       18.6
## 3          NA            81.48   32866268             23.890       16.8
## 4          NA            84.26    2877800            104.871       38.0
## 5          NA              NaN      77265            163.755        NaN
## 6          NA              NaN    9890400            112.442       34.0
##   aged_65_older aged_70_older gdp_per_capita extreme_poverty cvd_death_rate
## 1        13.085         7.452      35973.781             NaN            NaN
## 2         2.581         1.337       1803.987             NaN        597.029
## 3         2.405         1.362       5819.495             NaN        276.045
## 4        13.188         8.643      11803.431             1.1        304.195
## 5           NaN           NaN            NaN             NaN        109.135
## 6         1.144         0.526      67293.483             NaN        317.840
##   diabetes_prevalence female_smokers male_smokers handwashing_facilities
## 1               11.62            NaN          NaN                    NaN
## 2                9.59            NaN          NaN                 37.746
## 3                3.94            NaN          NaN                 26.664
## 4               10.08            7.1         51.2                    NaN
## 5                7.97           29.0         37.8                    NaN
## 6               17.26            1.2         37.4                    NaN
##   hospital_beds_per_100k total_cases total_deaths total_cases_per_million
## 1                    NaN         101            3                 945.994
## 2                   0.50       11173          219                 287.015
## 3                    NaN          69            4                   2.099
## 4                   2.89        1004           32                 348.878
## 5                    NaN         763           51                9875.105
## 6                   1.20       30307          248                3064.285
##   total_deaths_per_million total_tests total_tests_per_thousand
## 1                   28.099          NA                       NA
## 2                    5.626          NA                       NA
## 3                    0.122          NA                       NA
## 4                   11.120          NA                       NA
## 5                  660.066          NA                       NA
## 6                   25.075          NA                       NA
##   C1_School.closing C1_Flag C2_Workplace.closing C2_Flag
## 1                 3       1                    2       1
## 2                 3       1                    3       0
## 3                 3       1                    2       1
## 4                 3       1                    2       1
## 5                 3       1                    2       1
## 6                 3       1                    2       1
##   C3_Cancel.public.events C3_Flag C4_Restrictions.on.gatherings C4_Flag
## 1                       2       1                             4       1
## 2                       2       1                             4       1
## 3                       2       1                             3       1
## 4                       2       1                             4       1
## 5                       1       1                             0    &lt;NA&gt;
## 6                       2       1                             4       1
##   C5_Close.public.transport C5_Flag C6_Stay.at.home.requirements C6_Flag
## 1                         0    &lt;NA&gt;                            2       1
## 2                         2       0                            2       0
## 3                         1       1                            2       1
## 4                         2       0                            2       1
## 5                         1       1                            1       1
## 6                         1       1                            2       1
##   C7_Restrictions.on.internal.movement C7_Flag C8_International.travel.controls
## 1                                    2       1                                3
## 2                                    2       0                                1
## 3                                    2       0                                4
## 4                                    2       1                                4
## 5                                    0    &lt;NA&gt;                                3
## 6                                    1       1                                4
##   E1_Income.support E1_Flag E2_Debt.contract.relief E3_Fiscal.measures
## 1                 2       1                       0                  0
## 2                 0    &lt;NA&gt;                       0                  0
## 3                 0    &lt;NA&gt;                       2                  0
## 4                 2       0                       1                  0
## 5                 2       1                       0                  0
## 6                 0    &lt;NA&gt;                       2                  0
##   E4_International.support H1_Public.information.campaigns H1_Flag
## 1                        0                               2       1
## 2                        0                               2       1
## 3                        0                               1       1
## 4                        0                               2       1
## 5                        0                               2       1
## 6                        0                               2       1
##   H2_Testing.policy H3_Contact.tracing H4_Emergency.investment.in.healthcare
## 1                 1                  1                                     0
## 2                 1                  1                                     0
## 3                 2                  0                                     0
## 4                 2                  1                                     0
## 5                 3                  1                                     0
## 6                 3                  2                                     0
##   H5_Investment.in.vaccines M1_Wildcard ConfirmedCases ConfirmedDeaths
## 1                         0          NA            101               3
## 2                         0          NA           6402              57
## 3                         0          NA             48               2
## 4                         0          NA            712              31
## 5                         0          NA            761              51
## 6                         0          NA           9813              64
##   StringencyIndex StringencyIndexForDisplay StringencyLegacyIndex
## 1            78.7                      78.7                 76.43
## 2            78.7                      78.7                 75.48
## 3            78.7                      78.7                 80.48
## 4           89.81                     89.81                 88.81
## 5           52.78                        50                 74.05
## 6           81.48                     81.48                 85.24
##   StringencyLegacyIndexForDisplay GovernmentResponseIndex
## 1                           76.43                   68.59
## 2                           75.48                    60.9
## 3                           80.48                   67.31
## 4                           88.81                   80.77
## 5                           71.19                   55.77
## 6                           85.24                   79.49
##   GovernmentResponseIndexForDisplay ContainmentHealthIndex
## 1                             68.59                  71.97
## 2                              60.9                  71.97
## 3                             67.31                  70.45
## 4                             80.77                  84.09
## 5                             61.54                  56.82
## 6                             79.49                  84.85
##   ContainmentHealthIndexForDisplay EconomicSupportIndex
## 1                            71.97                   50
## 2                            71.97                    0
## 3                            70.45                   50
## 4                            84.09                 62.5
## 5                            54.55                   50
## 6                            84.85                   50
##   EconomicSupportIndexForDisplay
## 1                             50
## 2                              0
## 3                             50
## 4                           62.5
## 5                            100
## 6                             50</code></pre>
<p>We will now save it to use later. Since this code will pull up new data every day it is run, let’s save the file with today’s date in the name. We can concatenate different character vectors by using the function <code>paste0()</code> and get today’s date as a character by using the function <code>as.character()</code></p>
<pre class="r"><code>filename = paste0(&#39;covid_data_&#39;, as.character(Sys.Date()),&#39;.csv&#39;)
write.csv(x = joint_covid, file = filename)</code></pre>
</div>
</div>

</div>

        <footer class="post-footer clearfix">
    

    <div class="share">
        
            <a class="icon-twitter" href="https://twitter.com/share?text=Tutorial%204%20-%20Statistical%20Modeling&url=%2fcourses%2f2020_stri_introR%2ftutorials%2fl4_stats%2f"
                onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <i class="fa fa-twitter"></i>
                <span class="hidden">Twitter</span>
            </a>
        

        
            <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=%2fcourses%2f2020_stri_introR%2ftutorials%2fl4_stats%2f"
                onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                <i class="fa fa-facebook"></i>
                <span class="hidden">Facebook</span>
            </a>
        

        
        
    </div>
</footer>
    </article>
</div>

            </div>
        </div>

        <footer class="footer">
            <div class="container">
                <div class="site-title-wrapper">
                    <h1 class="site-title">
                        <a title="Tutorials" href="/courses/2020_stri_introR/">Tutorials</a>
                    </h1>
                    <a class="button-square button-jump-top js-jump-top" href="#">
                        <i class="fa fa-angle-up"></i>
                    </a>
                </div>

                <p class="footer-copyright">
                    <span>&copy; 2020 / Powered by <a href="https://gohugo.io/">Hugo</a></span>
                </p>
                <p class="footer-copyright">
                    <span><a href="https://github.com/roryg/ghostwriter">Ghostwriter theme</a> By <a href="http://jollygoodthemes.com">JollyGoodThemes</a></span>
                    <span>/ <a href="https://github.com/jbub/ghostwriter">Ported</a> to Hugo By <a href="https://github.com/jbub">jbub</a></span>
                </p>
            </div>
        </footer>

        <script src="/courses/2020_stri_introR/js/jquery-1.11.3.min.js"></script>
        <script src="/courses/2020_stri_introR/js/jquery.fitvids.js"></script>
        <script src="/courses/2020_stri_introR/js/scripts.js"></script>
    </body>
</html>

